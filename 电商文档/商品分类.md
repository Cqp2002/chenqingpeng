# ÂïÜÂìÅÂàÜÁ±ªÁÆ°ÁêÜ

### üí®ÂàÜÁ±ªÊü•ËØ¢

#### 	1. mingrui-shop-common-core Â∑•Á®ã

- Âú® `mingrui-shop-commons` È°πÁõÆ‰∏ãÊñ∞Âª∫ `mingrui-shop-common-core` È°πÁõÆ

  - pom.xml

    ```
     <dependencies>
            <!--Â§ÑÁêÜjson‰∏éÂêÑÁßçÊï∞ÊçÆÁ±ªÂûãÊàñÊñáÊ°£Á±ªÂûãÁöÑËΩ¨Êç¢-->
            <dependency>
                <groupId>com.google.code.gson</groupId>
                <artifactId>gson</artifactId>
                <version>2.8.5</version>
            </dependency>
            <!--jsonÂØπË±°Â∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÁöÑÊîØÊåÅ-->
            <dependency>
                <groupId>org.codehaus.jackson</groupId>
                <artifactId>jackson-core-lgpl</artifactId>
                <version>1.9.13</version>
            </dependency>
            <dependency>
                <groupId>org.codehaus.jackson</groupId>
                <artifactId>jackson-mapper-lgpl</artifactId>
                <version>1.9.13</version>
            </dependency>
            <!--javaÂØπË±°ÂíåjsonÂØπË±°‰πãÈó¥ÁöÑËΩ¨Êç¢-->
            <dependency>
                <groupId>org.codehaus.jackson</groupId>
                <artifactId>jackson-core-asl</artifactId>
                <version>1.9.13</version>
            </dependency>
            <dependency>
                <groupId>org.codehaus.jackson</groupId>
                <artifactId>jackson-mapper-asl</artifactId>
                <version>1.9.13</version>
            </dependency>
    
            <!--alibabaÁöÑjsonÂ§ÑÁêÜÂ∑•ÂÖ∑-->
            <dependency>
                <groupId>com.alibaba</groupId>
                <artifactId>fastjson</artifactId>
                <version>1.2.62</version>
            </dependency>
            <dependency>
                <groupId>com.fasterxml.jackson.core</groupId>
                <artifactId>jackson-databind</artifactId>
                <version>2.11.2</version>
            </dependency>
        </dependencies>
    ```

  - Êñ∞Âª∫ÂåÖ com.baidu.shop.utils

    - JSONUtil

      ```
      package com.baidu.shop.utils;
      
      import com.alibaba.fastjson.JSONObject;
      import org.codehaus.jackson.JsonParseException;
      import org.codehaus.jackson.map.JsonMappingException;
      import org.codehaus.jackson.map.ObjectMapper;
      import org.codehaus.jackson.type.TypeReference;
      import com.google.gson.Gson;
      import com.google.gson.GsonBuilder;
      import com.google.gson.JsonArray;
      import com.google.gson.JsonElement;
      import com.google.gson.JsonObject;
      import com.google.gson.JsonParser;
      import com.google.gson.reflect.TypeToken;
      
      import java.io.FileOutputStream;
      import java.io.IOException;
      import java.util.ArrayList;
      import java.util.HashMap;
      import java.util.List;
      import java.util.Map;
      
      public class JSONUtil {
      
          private static Gson gson = null;
      
          static {
              gson = new GsonBuilder().setDateFormat("yyyy-MM-dd HH:mm:ss").create();// todo yyyy-MM-dd HH:mm:ss
          }
      
          public static synchronized Gson newInstance() {
              if (gson == null) {
                  gson = new GsonBuilder().setDateFormat("yyyy-MM-dd HH:mm:ss").create();
              }
              return gson;
          }
      
          public static String toJsonString(Object obj) {
              return gson.toJson(obj);
          }
      
          public static <T> T toBean(String json, Class<T> clz) {
      
              return gson.fromJson(json, clz);
          }
      
          public static <T> Map<String, T> toMap(String json, Class<T> clz) {
              Map<String, JsonObject> map = gson.fromJson(json, new TypeToken<Map<String, JsonObject>>() {
              }.getType());
              Map<String, T> result = new HashMap<String, T>();
              for (String key : map.keySet()) {
                  result.put(key, gson.fromJson(map.get(key), clz));
              }
              return result;
          }
      
          public static Map<String, Object> toMap(String json) {
              Map<String, Object> map = gson.fromJson(json, new TypeToken<Map<String, Object>>() {
              }.getType());
              return map;
          }
      
          public static <T> List<T> toList(String json, Class<T> clz) {
              JsonArray array = new JsonParser().parse(json).getAsJsonArray();
              List<T> list = new ArrayList<T>();
              for (final JsonElement elem : array) {
                  list.add(gson.fromJson(elem, clz));
              }
              return list;
          }
      
          public static <T> Object getObjectByKey(String json, Class<T> clazz) {
              if (json != null && !"".equals(json)) {
                  return JSONObject.parseObject(json, clazz);
              }
              return null;
          }
      
          public static <T> List<T> getListByKey(String json, Class<T> clazz) {
              if (json != null && !"".equals(json)) {
                  return JSONObject.parseArray(json, clazz);
              }
              return null;
          }
          
          public static String getStrByKey(String json, String key) {
              String str = "";
              if (json != null && !"".equals(json)) {
                  JSONObject j = JSONObject.parseObject(json);
                  if (j.get(key) != null) {
                      str = j.get(key).toString();
                  }
              }
              return str;
          }
      
          public static void writeByFileOutputStream(String _sDestFile, String _sContent) throws IOException {
              FileOutputStream fos = null;
              try {
                  fos = new FileOutputStream(_sDestFile);
                  fos.write(_sContent.getBytes());
              } catch (Exception ex) {
                  ex.printStackTrace();
              } finally {
                  if (fos != null) {
                      fos.close();
                      fos = null;
                  }
      
              }
          }
      
          public static boolean noEmpty(String str) {
              boolean flag = true;
              if ("".equals(str)) {
                  flag = false;
              }
              return flag;
          }
      
          public static double getDecimalByPercentage(String str) {
              double fuse = 0.0;
              if (!"".equals(str) && str != null) {
                  if (str.split("%").length > 0) {
                      fuse = Double.parseDouble(str.split("%")[0]);
                      return fuse;
                  }
              }
              return 0.0;
          }
      
          public static double ConversionFraction(double number) {
              return Math.floor(number * 100 + 0.5) / 100;
          }
      
          public static float ConversionM(double number) {
              return (float) JSONUtil.ConversionFraction(number / 1024 / 1024);
          }
      
          public static String getErrorText(String s) {
              JSONObject j = JSONObject.parseObject(s);
              return j.getJSONObject(j.keySet().iterator().next()).get("errortext").toString();
          }
      
          public static String getSingleJobId(String s) throws Exception {
              JSONObject j = JSONObject.parseObject(s);
              try {
                  return j.getJSONObject(j.keySet().iterator().next()).get("jobid").toString();
              } catch (Exception e) {
                  try {
                      return j.getJSONObject(j.keySet().iterator().next()).get("errortext").toString();
                  } catch (Exception e1) {
                      throw new Exception(e1.getMessage());
      
                  }
      
              }
          }
      
          public static <T> T readValue(String jsonStr, TypeReference type)
                  throws JsonParseException, JsonMappingException, IOException {
              ObjectMapper mapper = new ObjectMapper();
              return mapper.readValue(jsonStr, type);
          }
      
          public static JSON_TYPE getJSONType(String str) {
              if (null == str || "".equals(str)) {
                  return JSON_TYPE.JSON_TYPE_ERROR;
              }
      
              final char[] strChar = str.substring(0, 1).toCharArray();
              final char firstChar = strChar[0];
      
              if (firstChar == '{') {
                  return JSON_TYPE.JSON_TYPE_OBJECT;
              } else if (firstChar == '[') {
                  return JSON_TYPE.JSON_TYPE_ARRAY;
              } else {
                  return JSON_TYPE.JSON_TYPE_ERROR;
              }
          }
      
          public enum JSON_TYPE {
              /** JSONObject */
              JSON_TYPE_OBJECT,
              /** JSONArray */
              JSON_TYPE_ARRAY,
              /** ‰∏çÊòØJSONÊ†ºÂºèÁöÑÂ≠óÁ¨¶‰∏≤ */
              JSON_TYPE_ERROR
          }
      }
      
      ```

  -  Êñ∞Âª∫ÂåÖ com.baidu.shop.status

    - HTTPStatus

      ```
      package com.baidu.shop.status;
      
      public class HTTPStatus {
      
          public static final int OK = 200;//ÊàêÂäü
      
          public static final int ERROR = 500;//Â§±Ë¥•
      
      }
      ```

  - Êñ∞Âª∫ÂåÖ com.baidu.shop.base

    - Result

      ```
      package com.baidu.shop.base;
      
      import lombok.Data;
      import lombok.NoArgsConstructor;
      
      @Data // ÁîüÊàêset ÂíågetÂáΩÊï∞
      @NoArgsConstructor //ÁîüÊàêÊó†ÂèÇÊûÑÈÄ†ÂáΩÊï∞
      public class Result<T> {
      
          private Integer code;//ËøîÂõûÁ†Å,
      
          private String message;//ËøîÂõûÊ∂àÊÅØ
      
          private T data;//ËøîÂõûÊï∞ÊçÆ
      
          public Result(Integer code, String message, Object data) {
              this.code = code;
              this.message = message;
              this.data = (T) data;
          }
      }
      ```

    - BaseApiService

      ```
      package com.baidu.shop.base;
      
      import com.baidu.shop.status.HTTPStatus;
      import com.baidu.shop.utils.JSONUtil;
      import lombok.Data;
      import lombok.extern.slf4j.Slf4j;
      import org.apache.commons.logging.Log;
      import org.apache.commons.logging.LogFactory;
      import org.springframework.stereotype.Component;
      
      @Data
      @Component
      @Slf4j
      public class BaseApiService<T> {
      
          public Result<T> setResultError(Integer code, String msg) {
              return setResult(code, msg, null);
          }
      
          // ËøîÂõûÈîôËØØÔºåÂèØ‰ª•‰º†msg
          public Result<T> setResultError(String msg) {
      
              return setResult(HTTPStatus.ERROR, msg, null);
          }
      
          // ËøîÂõûÊàêÂäüÔºåÂèØ‰ª•‰º†dataÂÄº
          public Result<T> setResultSuccess(T data) {
              return setResult(HTTPStatus.OK, HTTPStatus.OK + "", data);
          }
      
          // ËøîÂõûÊàêÂäüÔºåÊ≤íÊúâdataÂÄº
          public Result<T> setResultSuccess() {
              return setResult(HTTPStatus.OK, HTTPStatus.OK + "", null);
          }
      
          // ËøîÂõûÊàêÂäüÔºåÊ≤íÊúâdataÂÄº
          public Result<T> setResultSuccess(String msg) {
              return setResult(HTTPStatus.OK, msg, null);
          }
      
          // ÈÄöÁî®Â∞ÅË£Ö
          public Result<T> setResult(Integer code, String msg, T data) {
              log.info(String.format("{code : %s , msg : %s , data : %s}",code,msg, JSONUtil.toJsonString(data)));
              return new Result<T>(code, msg, data);
          }
      
      }
      ```

#### 2. service-api Â∑•Á®ã

- `mingrui-shop-service-api` 

  - pom.xml

    ```
       <!--Entity ‰∏≠ÁöÑ@Table Âíå@IdÈúÄË¶ÅÊ≠§Ê≥®Ëß£-->
            <dependency>
                <groupId>javax.persistence</groupId>
                <artifactId>persistence-api</artifactId>
                <version>1.0.2</version>
            </dependency>
    
            <!--2.3ÁâàÊú¨‰πãÂêéwebÂà†Èô§‰∫ÜÈ™åËØÅÊèí‰ª∂-->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-validation</artifactId>
            </dependency>
    
            <!--ÂºïÂÖ•commonÂ∑•Á®ã‰ª£Á†Å ÊääÂæÆÊúçÂä°ÁöÑËøô‰∏™Ê¶ÇÂøµÂÅöÂà∞ÊûÅËá¥   ËÆ©Ê®°Âùó(ÊúçÂä°) Â§çÁî®-->
            <dependency>
                <groupId>com.baidu</groupId>
                <artifactId>mingrui-shop-common-core</artifactId>
                <version>1.0-SNAPSHOT</version>
            </dependency>
    ```

#### 3. Âú® mingrui-shop-service-api È°πÁõÆ‰∏ã

- ##### Êñ∞Âª∫ mingrui-shop-service-api-xxx È°πÁõÆ
  - pom.xml

  ```
   <dependencies>
          <!--Â∏ÆÂä©ÂºÄÂèë‰∫∫ÂëòÂø´ÈÄüÁîüÊàêAPIÊñáÊ°£-->
          <dependency>
              <groupId>io.springfox</groupId>
              <artifactId>springfox-swagger2</artifactId>
              <version>2.9.2</version>
          </dependency>
          <!--Êèê‰æõÂèØËßÜÂåñÁöÑAPIÊñáÊ°£-->
          <dependency>
              <groupId>io.springfox</groupId>
              <artifactId>springfox-swagger-ui</artifactId>
              <version>2.9.2</version>
          </dependency>
      </dependencies>
  ```

  - Êñ∞Âª∫ÂåÖ com.baidu.shop.entity

    - CategoryEntity

      ```
      package com.baidu.shop.entity;
      
      import com.baidu.shop.validate.group.MingruiOperation;
      import io.swagger.annotations.ApiModel;
      import io.swagger.annotations.ApiModelProperty;
      import lombok.Data;
      
      import javax.persistence.Id;
      import javax.persistence.Table;
      import javax.validation.constraints.NotEmpty;
      import javax.validation.constraints.NotNull;
      
      @ApiModel(value = "ÂàÜÁ±ªÂÆû‰ΩìÁ±ª")//swaggerÁöÑÊ≥®Ëß£ : Â£∞ÊòéÊ®°Âûã
      @Data
      @Table(name = "tb_category") //java ÁöÑÂÆû‰ΩìÁ±ªÂíåÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑË°®ÂÅöÊò†Â∞Ñ
      public class CategoryEntity {
      
          @Id //Â£∞Êòé‰∏ªÈîÆ
          @ApiModelProperty(value = "Á±ªÁõÆid",example = "1") //ÊâÄÊúâÁöÑÊï∞Â≠óÁ±ªÂûãÂú®ÂÜôswaggerÁöÑÊó∂ÂÄôÈúÄË¶ÅÂä†example="ÈªòËÆ§ÂÄº",ÊµãËØïÊé•Âè£
          private Integer id;//Â¶ÇÊûúÊ≤°Êúâ@Column ÈªòËÆ§‰ΩøÁî®entityÁöÑÂ±ûÊÄßÂêçÂíå Êï∞ÊçÆÂ∫ìË°®ÁöÑÂ≠óÊÆµÂêçÂÅöÊò†Â∞Ñ
      
          @ApiModelProperty(value = "Á±ªÁõÆÂêçÁß∞")
          private String name;
      
          @ApiModelProperty(value = "Áà∂Á±ªÁõÆid,È°∂Á∫ßÁ±ªÁõÆÂ°´0",example = "1")
          private Integer parentId;//‰ºöËá™Âä®Â∞ÜÈ©ºÂ≥∞ËΩ¨Êç¢‰∏∫ _xÁöÑÂΩ¢Âºè
      
          @ApiModelProperty(value = "ÊòØÂê¶ÊòØÁà∂Á∫ßËäÇÁÇπ",example = "1")
          private Integer isParent;
      
          @ApiModelProperty(value = "ÊéíÂ∫è",example = "1")
          private Integer sort;
      
      }
      ```

  - Êñ∞Âª∫ÂåÖ com.baidu.shop.config 

    - MrSwagger2Config

      ```
      package com.baidu.shop.config;
      
      import org.springframework.context.annotation.Bean;
      import org.springframework.context.annotation.Configuration;
      import springfox.documentation.builders.ApiInfoBuilder;
      import springfox.documentation.builders.PathSelectors;
      import springfox.documentation.builders.RequestHandlerSelectors;
      import springfox.documentation.service.ApiInfo;
      import springfox.documentation.service.Contact;
      import springfox.documentation.spi.DocumentationType;
      import springfox.documentation.spring.web.plugins.Docket;
      import springfox.documentation.swagger2.annotations.EnableSwagger2;
      
      @Configuration
      @EnableSwagger2
      public class MrSwagger2Config {
      
          @Bean
          public Docket createRestApi(){
              return new Docket(DocumentationType.SWAGGER_2)
                      .apiInfo(this.apiInfo())
                      .select()
                      .apis(RequestHandlerSelectors.basePackage("com.baidu"))
                      .paths(PathSelectors.any())
                      .build();
          }
      
          private ApiInfo apiInfo(){
              return new ApiInfoBuilder()
                      //Ê†áÈ¢ò
                      .title("ÊòéÁëûSWAGGER2Ê†áÈ¢ò")
                      //Êù°Ê¨æÂú∞ÂùÄ
                      .termsOfServiceUrl("http://www.baidu.com")
                      //ËÅîÁ≥ªÊñπÂºè-->ÊúâStringÂèÇÊï∞ÁöÑÊñπÊ≥ï‰ΩÜÊòØÂ∑≤ÁªèËøáÊó∂ÔºåÊâÄ‰ª•‰∏çÊé®Ëçê‰ΩøÁî®
                      .contact(new Contact("shenyaqi","baidu.com","shenyaqiii@163.com"))
                      //ÁâàÊú¨
                      .version("v1.0")
                      //È°πÁõÆÊèèËø∞
                      .description("ÊèèËø∞")
                      //ÂàõÂª∫APIÂü∫Êú¨‰ø°ÊÅØ
                      .build();
          }
      }
      ```

- #####  ÂÆö‰πâÂïÜÂìÅÂàÜÁ±ªÊé•Âè£
  - Êñ∞Âª∫ÂåÖ com.baidu.shop.service

    - CategoryService 

    ```
    package com.baidu.shop.service;
    
    import com.baidu.shop.base.Result;
    import com.baidu.shop.entity.CategoryEntity;
    import com.baidu.shop.validate.group.MingruiOperation;
    import com.google.gson.JsonObject;
    import io.swagger.annotations.Api;
    import io.swagger.annotations.ApiOperation;
    import org.springframework.validation.annotation.Validated;
    import org.springframework.web.bind.annotation.*;
    
    import java.util.List;
    
    @Api(tags = "ÂïÜÂìÅÂàÜÁ±ªÊé•Âè£") // Â£∞ÊòéÊé•Âè£
    public interface CategoryService {
    
        @ApiOperation(value = "ÈÄöËøápidÊü•ËØ¢ÂïÜÂìÅÂàÜÁ±ª")
        @GetMapping(value = "category/list")
        Result<List<CategoryEntity>> getCategoryByPid(Integer pid);
    
    }
    ```

#### 4. mingrui-shop-service Â∑•Á®ã

- pom.xml

  ```
    <dependencies>
          <!-- SpringBoot-Êï¥ÂêàWebÁªÑ‰ª∂ -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-web</artifactId>
          </dependency>
          <!-- springcloud feignÁªÑ‰ª∂ -->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-openfeign</artifactId>
          </dependency>
          <!--mysqlÊï∞ÊçÆÂ∫ìËøûÊé•-->
          <dependency>
              <groupId>mysql</groupId>
              <artifactId>mysql-connector-java</artifactId>
              <scope>runtime</scope><!--È°πÁõÆËøêË°åÈò∂ÊÆµ‰ΩøÁî®-->
          </dependency>
          <!--ÈÄöÁî®mapper-->
          <dependency>
              <groupId>tk.mybatis</groupId>
              <artifactId>mapper-spring-boot-starter</artifactId>
              <version>2.1.5</version>
          </dependency>
  
          <!--ÂàÜÈ°µÂ∑•ÂÖ∑
          Ëá™ÂÆö‰πâÁöÑ mybatis Êèí‰ª∂
          mybatisËøêË°åÂéüÁêÜ mybatisÁöÑÊâßË°åÂô®-->
          <dependency>
              <groupId>com.github.pagehelper</groupId>
              <artifactId>pagehelper-spring-boot-starter</artifactId>
              <version>1.2.10</version>
          </dependency>
  
          <dependency>
              <groupId>com.baidu</groupId>
              <artifactId>mingrui-shop-service-api-xxx</artifactId>
              <version>1.0-SNAPSHOT</version>
          </dependency>
      </dependencies>
  ```

- ##### Âú® mingrui-shop-service Â∑•Á®ã‰∏ãÊñ∞Âª∫ mingrui-shop-service-xxx Â∑•Á®ã

  - application.yml

    ```
    server:
      port: 8100
    
    spring:
      application:
        name: xxx-server
      # ÈÖçÁΩÆÊï∞ÊçÆÊ∫ê
      datasource:
        # Êï∞ÊçÆÊ∫êÂêçÁß∞Ôºå‰ªªÊÑè
        name: mysql
        url: jdbc:mysql://localhost:3306/2006?useSSL=true&nullNamePatternMatchesAll=true&serverTimezone=GMT%2B8&useUnicode=true&characterEncoding=utf8
        # Êï∞ÊçÆÂ∫ìËøûÊé•Áî®Êà∑
        username: root
        # Êï∞ÊçÆÂ∫ìËøûÊé•ÂØÜÁ†Å
        password: root
        # È©±Âä®ÂêçÁß∞
        driver-class-name: com.mysql.cj.jdbc.Driver
        # boot2.0+‰ΩøÁî®hikari‰Ωú‰∏∫ÈªòËÆ§Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†
        type: com.zaxxer.hikari.HikariDataSource
        hikari:
          # ÊòØÂê¶Ëá™Âä®Êèê‰∫§‰∫ãÂä° ÈªòËÆ§
          auto-commit: true
          # ÂÖÅËÆ∏ÁöÑÊúÄÂ∞èËøûÊé•Êï∞
          minimum-idle: 5
          # ËøûÊé•Ê±†ÂÜÖÊúÄÂ§ßËøûÊé•Êï∞
          maximum-pool-size: 10
          # È™åËØÅËøûÊé•ÁöÑsqlËØ≠Âè•
          connection-test-query: SELECT 1 FROM DUAL
          # ËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥ ÈªòËÆ§30000 ÊØ´Áßí Â¶ÇÊûúÂ∞è‰∫é250ÊØ´ÁßíÔºåÂàôË¢´ÈáçÁΩÆÂõû30Áßí
          connection-timeout: 30000
          # È™åËØÅË∂ÖÊó∂Êó∂Èó¥ÈªòËÆ§5000ÊØ´Áßí Â¶ÇÊûúÂ∞è‰∫é250ÊØ´ÁßíÔºåÂàô‰ºöË¢´ÈáçÁΩÆÂõû5Áßí
          validation-timeout: 5000
          # ËÆæÁΩÆËøûÊé•Âú®ËøûÊé•Ê±†‰∏≠ÁöÑÂ≠òÊ¥ªÊó∂Èó¥ Â¶ÇÊûú‰∏çÁ≠â‰∫é0‰∏îÂ∞è‰∫é30ÁßíÂàô‰ºöË¢´ÈáçÁΩÆÂõû30ÂàÜÈíü
          max-lifetime: 1800000
    # ÈÄöÁî®mapper
    mapper:
      mappers: tk.mybatis.mapper.common.Mapper
      identity: MYSQL
    #Êó•ÂøóËÆæÁΩÆ
    logging:
      level:
        # ÊâìÂç∞‰∏éÊàë‰ª¨Á®ãÂ∫èÁõ∏ÂÖ≥ÁöÑÊó•Âøó‰ø°ÊÅØ
        com.baidu.shop: debug
    # eurekaÈÖçÁΩÆ
    eureka:
      client:
        service-url:
          defaultZone: http://localhost:8761/eureka/
    ```

- Êñ∞Âª∫ÂåÖ com.baidu

  - Êñ∞Âª∫ÂêØÂä®Á±ª `RunXXXApplication`

    ```
    package com.baidu;
    
    import org.springframework.boot.SpringApplication;
    import org.springframework.boot.autoconfigure.SpringBootApplication;
    import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
    import tk.mybatis.spring.annotation.MapperScan;
    
    @SpringBootApplication
    @EnableEurekaClient
    @MapperScan("com.baidu.shop.mapper")
    public class RunXXXApplication {
        public static void main(String[] args) {
            SpringApplication.run(RunXXXApplication.class);
        }
    }
    ```

- Âú® com.baidu ‰∏ãÊñ∞Âª∫ÂåÖ shop.mapper

  - ÂàõÂª∫Êé•Âè£ CategoryMapper

    ```
    package com.baidu.shop.mapper;
    
    import com.baidu.shop.entity.CategoryEntity;
    import org.apache.ibatis.annotations.Select;
    import tk.mybatis.mapper.additional.idlist.SelectByIdListMapper;
    import tk.mybatis.mapper.common.Mapper;
    
    import java.util.List;
    
    public interface CategoryMapper extends Mapper<CategoryEntity>{
    
    }
    ```

- Âú® com.baidu ‰∏ãÊñ∞Âª∫ÂåÖ shop.service.impl

  - Êñ∞Âª∫ÂÆûÁé∞Á±ª `CategoryServiceImpl` 

    ```
    package com.baidu.shop.service.impl;
    
    import com.baidu.shop.base.BaseApiService;
    import com.baidu.shop.base.Result;
    import com.baidu.shop.entity.CategoryBrandEntity;
    import com.baidu.shop.entity.CategoryEntity;
    import com.baidu.shop.mapper.CategoryBrandMapper;
    import com.baidu.shop.mapper.CategoryMapper;
    import com.baidu.shop.service.CategoryService;
    import com.baidu.shop.utils.ObjectUtil;
    import com.google.gson.JsonObject;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.transaction.annotation.Transactional;
    import org.springframework.web.bind.annotation.RestController;
    import tk.mybatis.mapper.entity.Example;
    
    import java.util.List;
    
    
    @RestController
    public class CategoryServiceImpl extends BaseApiService implements CategoryService{
    
        @Autowired
        private CategoryMapper categoryMapper;
    
    
        @Override
        public Result<List<CategoryEntity>> getCategoryByPid(Integer pid) {
            CategoryEntity categoryEntity = new CategoryEntity();
            categoryEntity.setParentId(pid);
            List<CategoryEntity> list = categoryMapper.select(categoryEntity);
            return this.setResultSuccess(list);
        }
        
    }
    ```

- ##### ÊµèËßàÂô®ËæìÂÖ•

  ```
  http://localhost:8100/category/list
  ```

  ![](E:\Ê∑òÂÆùÈ°πÁõÆ\image\screenshot_20210106_153206.png)

#### 5. ÁΩëÂÖ≥ÊúçÂä°

- Âú® mingrui-shop-basic È°πÁõÆ‰∏ã

  - Êñ∞Âª∫ mingrui-shop-basic-zuul-server

    - pom.xml

      ```
      <dependencies>
              <!-- zuul -->
              <dependency>
                  <groupId>org.springframework.cloud</groupId>
                  <artifactId>spring-cloud-starter-netflix-zuul</artifactId>
              </dependency>
      
          </dependencies>
      ```

    - application.yml

      ```
      server:
        port: 8088
      
      spring:
        application:
          name: eureka-zuul
      
      zuul:
        # Â£∞ÊòéË∑ØÁî±
        routes:
          # Ë∑ØÁî±ÂêçÁß∞
          api-xxx:
            # Â£∞ÊòéÂ∞ÜÊâÄÊúâ‰ª•/api-ribbon/ÁöÑËØ∑Ê±ÇÈÉΩËΩ¨ÂèëÂà∞eureka-ribbonÁöÑÊúçÂä°‰∏≠
            path: /api-xxx/**
            serviceId: xxx-server
        # ÂêØÁî®ÈáçËØï
        retryable: true
        # ÂåÖÂê´Ê≠§Ë∑ØÂæÑÁöÑ‰∏çËøõË°åË∑ØÁî±
        ignored-patterns: /upload/**
        # ÂøΩÁï•‰∏ä‰º†ÊúçÂä°
        ignored-services:
          -upload-server
      #ÈÖçÁΩÆË¥üËΩΩ
      ribbon:
        ConnectTimeout: 250 # ËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥(ms)
        ReadTimeout: 2000 # ÈÄö‰ø°Ë∂ÖÊó∂Êó∂Èó¥(ms)
        OkToRetryOnAllOperations: true # ÊòØÂê¶ÂØπÊâÄÊúâÊìç‰ΩúÈáçËØï
        MaxAutoRetriesNextServer: 2 # Âêå‰∏ÄÊúçÂä°‰∏çÂêåÂÆû‰æãÁöÑÈáçËØïÊ¨°Êï∞
        MaxAutoRetries: 1 # Âêå‰∏ÄÂÆû‰æãÁöÑÈáçËØïÊ¨°Êï∞
      
      hystrix:
        command:
          default:
            execution:
              isolation:
                thread:
                  timeoutInMilliseconds: 10000 # ÁÜîÊñ≠Ë∂ÖÊó∂Êó∂ÈïøÔºö6000ms
      
      eureka:
        client:
          service-url:
            defaultZone: http://localhost:8761/eureka/
      ```

  - Êñ∞Âª∫ÂåÖ com.baidu

    - Êñ∞Âª∫ÂêØÂä®Á±ª RunZuulServerApplication 

      ```
      package com.baidu;
      
      import org.springframework.boot.SpringApplication;
      import org.springframework.boot.autoconfigure.SpringBootApplication;
      import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
      import org.springframework.cloud.netflix.zuul.EnableZuulProxy;
      
      @SpringBootApplication
      @EnableZuulProxy
      @EnableEurekaClient
      public class RunZuulServerApplication {
          public static void main(String[] args) {
              SpringApplication.run(RunZuulServerApplication.class);
          }
      }
      ```

  - Êñ∞Âª∫ÂåÖ com.baidu.global

    - Êñ∞Âª∫Á±ª GlobalCorsConfig

      ```
      package com.baidu.global;
      
      import org.springframework.context.annotation.Bean;
      import org.springframework.context.annotation.Configuration;
      import org.springframework.web.cors.CorsConfiguration;
      import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
      import org.springframework.web.filter.CorsFilter;
      
      @Configuration
      public class GlobalCorsConfig {
          @Bean
          public CorsFilter corsFilter() {
      
              final UrlBasedCorsConfigurationSource source = new  UrlBasedCorsConfigurationSource();
      
              final CorsConfiguration config = new CorsConfiguration();
      
              config.setAllowCredentials(true); // ÂÖÅËÆ∏cookiesË∑®Âüü
      
              config.addAllowedOrigin("*");// ÂÖÅËÆ∏ÂêëËØ•ÊúçÂä°Âô®Êèê‰∫§ËØ∑Ê±ÇÁöÑURIÔºå*Ë°®Á§∫ÂÖ®ÈÉ®ÂÖÅËÆ∏„ÄÇ
              // ËøôÈáåÂ∞ΩÈáèÈôêÂà∂Êù•Ê∫êÂüüÔºåÊØîÂ¶Çhttp://xxxx:8080 ,‰ª•Èôç‰ΩéÂÆâÂÖ®È£éÈô©„ÄÇ„ÄÇ
      
              config.addAllowedHeader("*");// ÂÖÅËÆ∏ËÆøÈóÆÁöÑÂ§¥‰ø°ÊÅØ,*Ë°®Á§∫ÂÖ®ÈÉ®
              config.setMaxAge(18000L);// È¢ÑÊ£ÄËØ∑Ê±ÇÁöÑÁºìÂ≠òÊó∂Èó¥ÔºàÁßíÔºâÔºåÂç≥Âú®Ëøô‰∏™Êó∂Èó¥ÊÆµÈáåÔºåÂØπ‰∫éÁõ∏Âêå  ÁöÑË∑®ÂüüËØ∑Ê±Ç‰∏ç‰ºöÂÜçÈ¢ÑÊ£Ä‰∫Ü
              config.addAllowedMethod("*");// ÂÖÅËÆ∏Êèê‰∫§ËØ∑Ê±ÇÁöÑÊñπÊ≥ïÔºå*Ë°®Á§∫ÂÖ®ÈÉ®ÂÖÅËÆ∏Ôºå‰πüÂèØ‰ª•ÂçïÁã¨ËÆæ  ÁΩÆGET„ÄÅPUTÁ≠â
              config.addAllowedMethod("HEAD");
              config.addAllowedMethod("GET");// ÂÖÅËÆ∏GetÁöÑËØ∑Ê±ÇÊñπÊ≥ï
              config.addAllowedMethod("PUT");
              config.addAllowedMethod("POST");
              config.addAllowedMethod("DELETE");
              config.addAllowedMethod("PATCH");
              source.registerCorsConfiguration("/**", config);
      
              //3.ËøîÂõûÊñ∞ÁöÑCorsFilter.
              return new CorsFilter(source);
          }
      }
      ```

      ![](E:\Ê∑òÂÆùÈ°πÁõÆ\image\screenshot_20210106_153825.png)

#### 6. vue È°πÁõÆ

- ##### Category.vue

  <img src="E:\Ê∑òÂÆùÈ°πÁõÆ\image\screenshot_20210106_154240.png" style="zoom:50%;" />

<img src="E:\Ê∑òÂÆùÈ°πÁõÆ\image\screenshot_20210106_154320.png" style="zoom: 50%;" />

‚Äã			

```
<template>
  <v-card>
      <v-flex xs12 sm10>
        <v-tree url="/category/list"
                :isEdit="isEdit"
                :key="delKey"
                @handleAdd="handleAdd"
                @handleEdit="handleEdit"
                @handleDelete="handleDelete"
                @handleClick="handleClick"
        />
      </v-flex>
  </v-card>
</template>
<script>
 // import {treeData} from '../../mockDB'
  export default {
    name: "category",
    data() {
      return {
        isEdit:true,
        //Âà∑Êñ∞
        delKey:0,
      }
    },
    methods: {
      handleAdd(node) {
        node.isParent = node.isParent?1:0;
        delete node.id;
        //Êñ∞Â¢û
        this.$http.post('/category/add',node).then(resp =>{     

          if(resp.data.code != 200){
            this.$message.error('Êñ∞Â¢ûÂ§±Ë¥•');
            return ;
          }
          this.$message.success('Êñ∞Â¢ûÊàêÂäü');
          this.delKey = new Date().getTime();

        }).catch(error => console.log(error))
      },
      //‰øÆÊîπ
      handleEdit(id, name) {
       this.$http.put('/category/update',{
         id:id,
         name:name
       }).then(resp => {
         if(resp.data.code != 200){
            this.$message.error('‰øÆÊîπÂ§±Ë¥•:' + resp.data.message);
            return ;
          }
          this.delKey = new Date().getTime();
          this.$message.success('‰øÆÊîπÊàêÂäü');
       }).catch(error => console.log(error))
      },
      //Âà†Èô§
     handleDelete(id) {
        this.$http.delete('/category/delete?id=' + id).then(resp => {
          if(resp.data.code != 200){
            this.$message.error('Âà†Èô§Â§±Ë¥•:' + resp.data.message);
            return ;
          }
          this.delKey = new Date().getTime();
          this.$message.success('Âà†Èô§ÊàêÂäü');
          //ÁÆ≠Â§¥ÂáΩÊï∞ÁöÑÂèÇÊï∞Â¶ÇÊûúÂè™Êúâ‰∏Ä‰∏™ ÈÇ£‰πà() ÂèØ‰ª•‰∏çÂÜô
          //ÁÆ≠Â§¥ÂáΩÊï∞ÁöÑÂáΩÊï∞‰Ωì‰∏≠Âè™Êúâ‰∏ÄË°å‰ª£Á†Å{}ÂèØ‰ª•‰∏çÂÜô
        }).catch(error => console.log(error))
      },
      handleClick(node) {
        console.log(node)
      }
    }
  };
</script>
<style scoped>
</style>
```

- ##### Tree.vue

  - getDataÊñπÊ≥ïÈáçÊñ∞Âà∂ÂÆö resp ÂõûË∞É

    ```
    <template>
      <v-list class="pt-0 pb-0" dense>
        <TreeItem
          class="item" :model="model" v-for="(model, index) in db" :key="index"
          :url="url"
          :isEdit="isEdit"
          :nodes="nodes"
          @handleAdd="handleAdd"
          @handleEdit="handleEdit"
          @handleDelete="handleDelete"
          @handleClick="handleClick"
        />
      </v-list>
    </template>
    <script>
      import TreeItem from './TreeItem';
      export default {
        name: "vTree",
        props: {
          url: String,
          isEdit: {
            type: Boolean,
            default: false
          },
          treeData:{
            type:Array
          }
        },
        data() {
          return {
            db: [],
            nodes:{
              opened:null,
              selected:{isSelected:false}
            }
          }
        },
        components: {
          TreeItem
        },
        created() {
          if(this.treeData && this.treeData.length > 0){
            this.db = this.treeData;
            return;
          }
          this.getData();
        },
        methods: {
          getData() {
            //Âä†ËΩΩ‰∏ÄÁ∫ßËèúÂçï
            this.$http.get(this.url, {params: {pid: 0}}).then(resp => {
              //ÊòæÁ§∫
              this.db = resp.data.data;
              this.db.forEach(n => n['path'] = [n.name])
            })
          },
          handleAdd(node) {
            this.$emit("handleAdd", this.copyNodeInfo(node));
          },
          handleEdit(id, name) {
            this.$emit("handleEdit", id, name)
          },
          handleDelete(id) {
            this.deleteById(id, this.db);
            this.$emit("handleDelete", id);
          },
          handleClick(node){
            this.$emit("handleClick", this.copyNodeInfo(node))
          },
          // Ê†πÊçÆidÂà†Èô§
          deleteById(id, arr) {
            let src = arr || this.db;
            for (let i in src) {
              let d = src[i];
              if (d.id === id) {
                src.splice(i, 1)
                return;
              }
              if (d.children && d.children.length > 0) {
                this.deleteById(id, d.children)
              }
            }
          },
          copyNodeInfo(node){
            const o = {};
            for(let i in node){
              o[i] = node[i];
            }
            return o;
          }
        },
        watch: {}
      }
    </script>
    
    <style scoped>
      .item {
        cursor: pointer;
      }
    </style>
    ```

- ##### Treeltem.vue

  - line:126 ‰øÆÊîπÂõûË∞É

    ```
    <template>
      <div>
        <v-list-tile
          @click="toggle" class="level1 pt-0 pb-0 mt-0 mb-0" :class="{'selected':isSelected}">
          <v-list-tile-avatar>
            <v-icon v-if="model.isParent">{{open ? 'folder_open' : 'folder'}}</v-icon>
            <v-icon v-if="!model.isParent">insert_drive_file</v-icon>
          </v-list-tile-avatar>
          <v-list-tile-content>
            <v-list-tile-title v-show="!beginEdit">
              <span >{{model.name}}</span>
            </v-list-tile-title>
            <input v-show="beginEdit" @click.stop="" :ref="model.id" v-model="model.name"
                   @blur="afterEdit" @keydown.enter="afterEdit"/>
          </v-list-tile-content>
          <v-list-tile-action v-if="isEdit">
            <v-btn icon @mouseover="c1='primary'" @mouseout="c1=''" :color="c1" @click.stop="addChild">
              <i class="el-icon-plus"/>
            </v-btn>
          </v-list-tile-action>
          <v-list-tile-action v-if="isEdit">
            <v-btn icon @mouseover="c2='success'" @mouseout="c2=''" :color="c2" @click.stop="editChild">
              <i class="el-icon-edit"/>
            </v-btn>
          </v-list-tile-action>
          <v-list-tile-action v-if="isEdit">
            <v-btn icon @mouseover="c3='error'" @mouseout="c3=''" :color="c3" @click.stop="deleteChild">
              <i class="el-icon-delete"/>
            </v-btn>
          </v-list-tile-action>
        </v-list-tile>
    
        <v-list v-if="isFolder" v-show="open" class="ml-4 pt-0 pb-0" dense transition="scale-transition">
          <tree-item
            class="item"
            v-for="(model, index) in model.children"
            :key="index"
            :model="model"
            :url="url"
            :isEdit="isEdit"
            :nodes="nodes"
            :parentState="open"
            @handleAdd="handleAdd"
            @handleEdit="handleEdit"
            @handleDelete="handleDelete"
            @handleClick="handleClick"
          >
          </tree-item>
        </v-list>
      </div>
    </template>
    
    <script>
      import Vue from 'vue'
    
      export default {
        name: "tree-item",
        props: {
          model: Object,
          url: String,
          isEdit: {
            type: Boolean,
            default: false
          },
          nodes: Object,
          parentState:Boolean
        },
        created() {
        },
        data: function () {
          return {
            c1: '',
            c2: '',
            c3: '',
            isSelected: false,
            open:false,
            beginEdit:false
          }
        },
        watch:{
          parentState(val){
            if(!val){
              this.open = val;
            }
          }
        },
        computed: {
          isFolder: function () {
            return this.model.children &&
              this.model.children.length > 0
          }
        },
        methods: {
          toggle: function () {
            // Â∞ÜÂÖ∂ÂÆÉË¢´ÈÄâ‰∏≠È°πÂèñÊ∂àÈÄâ‰∏≠
            this.nodes.selected.isSelected = false;
            // ÂΩìÂâçÈ°πË¢´ÈÄâ‰∏≠
            this.isSelected = true;
            // ‰øùÂ≠òÂΩìÂâçÈÄâ‰∏≠È°π
            this.nodes.selected = this
    
            // ÂÆ¢Êà∑Ëá™Â∑±ÁöÑÁÇπÂáª‰∫ã‰ª∂ÂõûË∞É
            this.handleClick(this.model);
    
            // Âà§Êñ≠ÊòØÂê¶‰∏∫È°∂Á∫ßËäÇÁÇπÔºåÈ°∂Á∫ßËäÇÁÇπÈúÄË¶ÅËÆ∞ÂΩïÂíåÊõøÊç¢
            if(this.model.parentId == 0){
              // Âà§Êñ≠ÊâìÂºÄËäÇÁÇπÊòØÂê¶ÊòØËá™Â∑±
              if(this.nodes.opened && this != this.nodes.opened){
                // ‰∏çÊòØÔºåÂàôÂÖ≥Èó≠ÂéüÊù•ÁöÑËäÇÁÇπ
                this.nodes.opened.open = false;
              }
              // Â∞ÜËá™Â∑±ËÆ∞ÂΩï‰∏∫ÊâìÂºÄÁöÑËäÇÁÇπ
              this.nodes.opened = this;
            }
            // ÂàáÊç¢ÂºÄÈó≠Áä∂ÊÄÅ
            this.open = !this.open;
            // Â¶ÇÊûúÂ∑≤ÁªèÊòØÂè∂Â≠êËäÇÁÇπ,ÊàñËÄÖËá™Â∑±ÊòØÂÖ≥Èó≠ÁöÑÔºåÊàñËÄÖËá™Â∑±Â∑≤ÁªèÊúâÂÑøÂ≠ê‰∫ÜÔºåÁªìÊùü
            if (!this.model.isParent || this.isFolder || !this.open) {
              return;
            }
            // Â±ïÂºÄÂêéÊü•ËØ¢Â≠êËäÇÁÇπ
            //ÁÇπÂáªÁà∂ËäÇÁÇπ‰ø°ÊÅØÂõûË∞É
            this.$http.get(this.url, {params: {pid: this.model.id}})
              .then(resp => {
                //ÊòæÁ§∫
              Vue.set(this.model, 'children', resp.data.data);
              // Â∞ÅË£ÖÂΩìÂâçËäÇÁÇπÁöÑË∑ØÂæÑ
              this.model.children.forEach(n => {
                n['path'] = [];
                this.model.path.forEach(p => n['path'].push(p));
                n['path'].push(n.name);
              });
            }).catch( e => {
              console.log(e);
            });
          },
          addChild: function () {
            let child = {
              id: 0,
              name: 'Êñ∞ÁöÑËäÇÁÇπ',
              parentId: this.model.id,
              isParent: false,
              sort:this.model.children? this.model.children.length + 1:1
            }
            if (!this.model.isParent) {
              Vue.set(this.model, 'children', [child]);
              this.model.isParent = true;
              this.open = true;
              this.handleAdd(child);
            } else {
              if (!this.isFolder) {
                this.$http.get(this.url, {params: {pid: this.model.id}}).then(resp => {
                  Vue.set(this.model, 'children', resp.data);
                  this.model.children.push(child);
                  this.open = true;
                  this.handleAdd(child);
                });
              } else {
                this.model.children.push(child);
                this.open = true;
                this.handleAdd(child);
              }
            }
          },
          deleteChild: function () {
    
            //Âà†Èô§
            //Âà§Êñ≠ÂΩìÂâçËäÇÁÇπÊòØÂê¶‰∏∫Áà∂ËäÇÁÇπ isParent == 1
            //ÊéßÂà∂Áà∂Á∫ßËäÇÁÇπÂíåÂ≠êÁ∫ßËäÇÁÇπ‰∏çËÉΩË¢´Âà†Èô§,Âè∂Â≠êËäÇÁÇπÊòØÂèØ‰ª•Ë¢´Âà†Èô§!!!
            if(this.model.isParent == 1){
                //ÊèêÁ§∫‰ø°ÊÅØ
                this.$message.warning('ÂΩìÂâçËäÇÁÇπ‰∏∫Áà∂ËäÇÁÇπÔºå‰∏çËÉΩÂà†Èô§');
                return ;
            }
    
    
            this.$message.confirm('Ê≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§Êï∞ÊçÆÔºåÊòØÂê¶ÁªßÁª≠?', 'ÊèêÁ§∫', {
              confirmButtonText: 'Á°ÆÂÆöÂà†Èô§',
              cancelButtonText: 'ÂèñÊ∂à',
              type: 'warning'
            }).then(() => {
              this.handleDelete(this.model.id);
            }).catch(()=>{
              this.$message.info('Â∑≤ÂèñÊ∂àÂà†Èô§');
            })
    
          },
          editChild() {
            this.beginEdit = true;
            this.$nextTick(() => this.$refs[this.model.id].focus());
          },
          //‰øÆÊîπ
          afterEdit() {
            if (this.beginEdit) {
              this.beginEdit = false;
              this.handleEdit(this.model.id, this.model.name);
            }
          },
          handleAdd(node) {
            this.$emit("handleAdd", node);
          },
          handleDelete(id) {
            this.$emit("handleDelete", id);
          },
          handleEdit(id, name) {
            this.$emit("handleEdit", id, name)
          },
          handleClick(node) {
            this.$emit("handleClick", node);
          }
        }
      }
    </script>
    
    <style scoped>
      .level1 {
        height: 40px;
      }
    
      .selected {
        background-color: rgba(105,184,249,0.75);
      }
    </style>
    ```

- ##### ‰æùÊ¨°ÂêØÂä® `eureka-server` , `xxx-service` , `zuul-server` , `vue` È°πÁõÆ

- ‰øùËØÅËá™Â∑±ÁöÑ hosts, nginxÊ≤°ÊúâÈóÆÈ¢ò

- ÊµèËßàÂô®ËæìÂÖ•

  ```
  http://manage.mrshop.com/
  ```

  ![](E:\Ê∑òÂÆùÈ°πÁõÆ\image\screenshot_20210106_155026.png)

### üí®ÂàÜÁ±ªÂà†Èô§

> Âà†Èô§Êù°‰ª∂
>
> 1. Áà∂ËäÇÁÇπ‰∏çËÉΩË¢´Âà†Èô§
> 2. Â¶ÇÊûúÊâßË°åÂà†Èô§Êó∂ÂèëÁé∞Â∑≤ÁªèÊ≤°ÊúâÂÖ∂‰ªñÂè∂Â≠êËäÇÁÇπ‰∫Ü ÈÇ£ÈúÄË¶ÅÂ∞ÜÂéüÊù•ÁöÑÁà∂Á∫ßËäÇÁÇπÂèòÊàêÂè∂Â≠êËäÇÁÇπ

------

##### vueÈ°πÁõÆ

- Treeltem.vue : line 164

  ```
        deleteChild: function () {
          if(this.model.isParent == 1){
              //ÊèêÁ§∫‰ø°ÊÅØ
              this.$message.warning('ÂΩìÂâçËäÇÁÇπ‰∏∫Áà∂ËäÇÁÇπÔºå‰∏çËÉΩÂà†Èô§');
              return ;
          }
          this.$message.confirm('Ê≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§Êï∞ÊçÆÔºåÊòØÂê¶ÁªßÁª≠?', 'ÊèêÁ§∫', {
            confirmButtonText: 'Á°ÆÂÆöÂà†Èô§',
            cancelButtonText: 'ÂèñÊ∂à',
            type: 'warning'
          }).then(() => {
            this.handleDelete(this.model.id);
          }).catch(()=>{
            this.$message.info('Â∑≤ÂèñÊ∂àÂà†Èô§');
          })
        },
  ```

- Category.vue

  ```
     handleDelete(id) {
          this.$http.delete('/category/delete?id=' + id).then(resp => {
            if(resp.data.code != 200){
              this.$message.error('Âà†Èô§Â§±Ë¥•:' + resp.data.message);
              return ;
            }
            this.delKey = new Date().getTime();
            this.$message.success('Âà†Èô§ÊàêÂäü');
          }).catch(error => console.log(error))
        },
  ```

  - üà≤Ê≥®ÊÑè: ÈúÄË¶ÅÁªôv-treeÁªÑ‰ª∂ÁªëÂÆö‰∏Ä‰∏™keyÁöÑÂ±ûÊÄß,ÈªòËÆ§ÂÄº‰∏∫ 0

    ```
     data() {
          return {
            delKey:0,
          }
     },
    ```

  - v-treeÁªÑ‰ª∂‰∏≠Âä†ÂÖ• :key="delKey"

  - Âà†Èô§ÊñπÊ≥ï‰∏≠ Âä†ÂÖ• this.delKey = new Date().getTime();

  - ËøôÊ†∑Âú®Âà†Èô§ÂÆåÊàêÂêéÂèØ‰ª•ÂÆûÁé∞ÁªÑ‰ª∂Âà∑Êñ∞ÁöÑÊïàÊûú

------

##### ÂêéÂè∞‰ª£Á†Å

- ##### mingrui-shop-service-api-xxx

  - CategoryService

    ```java
     @ApiOperation(value = "ÂàÜÁ±ªÂà†Èô§")
     @DeleteMapping(value = "/category/delete")
     Result<JsonObject> deleteCategoryById(Integer id);
    ```

- ##### mingrui-shop-common-core

  - Âú® com.baidu.shop.util ‰∏≠

    - Êñ∞Âª∫Á±ª `ObjectUtil` (ËÆ©‰ª£Á†ÅÊõ¥‰ºòÈõÖ)

      ```java
      package com.baidu.shop.utils;
      
      public class ObjectUtil {
          public static Boolean  isNull(Object obj){ return obj == null; }
      }
      ```

  - Âú® com.baidu.shop.status ‰∏≠

    - HTTPStatus

      ```java
      public static final int PARAMS_VALIDATE_ERROR = 5002;//ÂèÇÊï∞Ê†°È™åÂ§±Ë¥•
      ```

- ##### ÂÆûÁé∞Á±ª‰∏≠Ë¶ÅÂÅöÁöÑ‰∫ã

  > 1. ÈÄöËøáÂΩìÂâçidÊü•ËØ¢ÂàÜÁ±ª‰ø°ÊÅØ
  > 2. Âà§Êñ≠ÊòØÂê¶ÊúâÊï∞ÊçÆ
  > 3. Âà§Êñ≠ÂΩìÂâçËäÇÁÇπÊòØÂê¶Êó∂Áà∂ËäÇÁÇπ
  > 4. Âà§Êñ≠ÂΩìÂâçËäÇÁÇπÁöÑÁà∂ËäÇÁÇπ‰∏ã Èô§‰∫ÜÂΩìÂâçËäÇÁÇπÊòØÂê¶ËøòÊúâÂà´ÁöÑËäÇÁÇπ(‰∏öÂä°)
  >    - Ê≤°Êúâ: Â∞ÜÂΩìÂâçËäÇÁÇπÁöÑÁà∂ËäÇÁÇπ isParent ÁöÑÂÄºÊîπ‰∏∫0
  > 5. ÈÄöËøá id Âà†Èô§Êï∞ÊçÆ

- ##### ‰ª£Á†ÅÂÆûÁé∞

  ```java
  @Override
      @Transactional
      public Result<JsonObject> deleteCategoryById(Integer id) {
          //Âà§Êñ≠idÊòØÂê¶‰∏∫Á©∫ Êàñ Â∞è‰∫é0
          if(ObjectUtil.isNull(id) || id <= 0) return this.setResultError("id‰∏çÂêàÊ≥ï");
          CategoryEntity categoryEntity = categoryMapper.selectByPrimaryKey(id);
          //Âà§Êñ≠Êü•ËØ¢ÁöÑÊï∞ÊçÆÊòØÂê¶‰∏∫Á©∫
          if(ObjectUtil.isNull(categoryEntity)) return this.setResultError("Êï∞ÊçÆ‰∏çÂ≠òÂú®");
          //Âà§Êñ≠Êü•ËØ¢Êï∞ÊçÆÁöÑÁà∂ËäÇÁÇπ‰∏ãÊúâÊó†ÂÖ∂‰ªñËäÇÁÇπ
          if(categoryEntity.getIsParent() >= 1) return this.setResultError("ÂΩìÂâçËäÇÁÇπ‰∏∫Áà∂ËäÇÁÇπ");
          //Ëé∑ÂèñÁà∂ËäÇÁÇπ‰∏ãÁöÑÂÖ∂‰ªñÂ≠êËäÇÁÇπÁöÑÊï∞ÊçÆ
          //Â¶ÇÊûúÂΩìÂâçÂàÜÁ±ªË¢´ÂìÅÁâåÁªëÂÆöÁöÑËØù‰∏çËÉΩË¢´Âà†Èô§ --> ÈÄöËøáÂàÜÁ±ªidÊü•ËØ¢‰∏≠Èó¥Ë°®ÊòØÂê¶ÊúâÊï∞ÊçÆ true : ÂΩìÂâçÂàÜÁ±ª‰∏çËÉΩË¢´Âà†Èô§ false:ÁªßÁª≠ÊâßË°å
          Example example1 = new Example(CategoryBrandEntity.class);
          example1.createCriteria().andEqualTo("brandId",id);
          List<CategoryBrandEntity> categoryBrandEntities = categoryBrandMapper.selectByExample(example1);
          if(categoryBrandEntities.size()>=1)return this.setResultError("ÂΩìÂâçÂàÜÁ±ªË¢´ÂÖ∂‰ªñÂìÅÁâåÁªëÂÆö,Êó†Ê≥ïËøõË°åÂà†Èô§");
  
          Example example = new Example(categoryEntity.getClass());
          example.createCriteria().andEqualTo("parentId",categoryEntity.getParentId());
          List<CategoryEntity> categoryList = categoryMapper.selectByExample(example);
          //Âà§Êñ≠ÂÖ∂‰ªñÂ≠êËäÇÁÇπÁöÑÊï∞ÊçÆÊù°Êï∞ÊòØÂê¶Â∞è‰∫éÁ≠â‰∫é1SAFJSA
          if(categoryList.size() <= 1){
              CategoryEntity categoryEntity1 = new CategoryEntity();
              //ÂΩìÁà∂ËäÇÁÇπ‰∏ãÂè™Êúâ‰∏Ä‰∏™ÊàñÊ≤°ÊúâÂ≠êËäÇÁÇπÊó∂ASDAS
              //Â∞ÜËØ•ËäÇÁÇπÁöÑÁà∂ËäÇÁÇπÁöÑÂÄº‰øÆÊîπ‰∏∫0
              categoryEntity1.setIsParent(0);
              //Â∞ÜËØ•ËäÇÁÇπÁöÑid‰øÆÊîπ‰∏∫ËØ•ËäÇÁÇπÁöÑÁà∂id
              categoryEntity1.setId(categoryEntity.getParentId());
              categoryMapper.updateByPrimaryKeySelective(categoryEntity1);
          }
          //ÊâßË°åÂà†Èô§Êìç‰Ωú
          categoryMapper.deleteByPrimaryKey(id);
          //ËøîÂõû‰∏Ä‰∏™Âà†Èô§ÊàêÂäüÁöÑ‰ø°ÊÅØ
          return this.setResultSuccess();
      }
  ```

### üí®ÂàÜÁ±ª‰øÆÊîπ

##### vueÈ°πÁõÆ

- Â∞Ü Treeltem.vue ÁöÑ afterEdit ÊñπÊ≥ï this.model.beginEdit Êîπ‰∏∫ this.beginEdit

  ```vue
   afterEdit() {
          if (this.beginEdit) {
            this.beginEdit = false;
            this.handleEdit(this.model.id, this.model.name);
          }
   },
  ```

- Category.vue

  ```vue
  handleEdit(id, name) {
         this.$http.put('/category/update',{
           id:id,
           name:name
         }).then(resp => {
           if(resp.data.code != 200){
              this.$message.error('‰øÆÊîπÂ§±Ë¥•:' + resp.data.message);
              return ;
            }
            this.delKey = new Date().getTime();
            this.$message.success('‰øÆÊîπÊàêÂäü');
         }).catch(error => console.log(error))
  },
  ```

##### ÂêéÂè∞‰ª£Á†Å

- mingrui-shop-service-api-xxx

  - CategoryService

    ```java
    @ApiOperation(value = "ÂàÜÁ±ª‰øÆÊîπ")
    @PutMapping(value = "/category/edit")
    Result<JsonObject> putCategoryById(@RequestBody CategoryEntity categoryEntity);
    ```

- mingrui-shop-service-xxx

  - CategoryServiceImpl

    ```java
    @Override
    @Transactional
    public Result<JsonObject> putCategoryById(CategoryEntity categoryEntity) {
         categoryMapper.updateByPrimaryKeySelective(categoryEntity);
         return this.setResultSuccess();
    }
    ```

### üí®ÂàÜÁ±ªÊñ∞Â¢û

##### vueÈ°πÁõÆ

- Category.vue

  ```vue
  handleAdd(node) {
          node.isParent = node.isParent?1:0;
          delete node.id;
          this.$http.post('/category/add',node).then(resp =>{     
            if(resp.data.code != 200){
              this.$message.error('Êñ∞Â¢ûÂ§±Ë¥•');
              return ;
            }
            this.$message.success('Êñ∞Â¢ûÊàêÂäü');
            this.delKey = new Date().getTime();
          }).catch(error => console.log(error))
  },
  ```

##### ÂêéÂè∞‰ª£Á†Å

- mingrui-shop-service-api-xxx

  - CategoryService

    ```java
    @ApiOperation(value = "ÂàÜÁ±ªÊñ∞Â¢û")
    @PostMapping(value = "/category/save")
    Result<JsonObject> addCategoryEntity(@RequestBody CategoryEntity categoryEntity);
    ```

- mingrui-shop-service-xxx

  - CategoryServiceImpl

    ```java
    @Override
        @Transactional
        public Result<JsonObject> addCategoryEntity(CategoryEntity categoryEntity) {
        
            categoryMapper.insertSelective(categoryEntity);
            return this.setResultSuccess();
            
        }
    ```

### üí®È°πÁõÆ‰∏≠‰∏çÂÆåÁæéÁöÑÂú∞Êñπ

#### ÂèÇÊï∞Ê†°È™å

- mingrui-shop-common-core Â∑•Á®ãÊñ∞Âª∫ÂåÖ com.baidu.shop.validate.group

  - ÂåÖ‰∏ãÊñ∞Âª∫Êìç‰ΩúÁ±ª MingruiOperation

    ```
    package com.baidu.shop.validate.group;
    
    public class MingruiOperation {
    
        public interface Add{}
        public interface Update{}
    
    }
    ```

- mingrui-shop-service-api-xxx

  - CategoryEntity

    ```
    package com.baidu.shop.entity;
    
    import com.baidu.shop.validate.group.MingruiOperation;
    import io.swagger.annotations.ApiModel;
    import io.swagger.annotations.ApiModelProperty;
    import lombok.Data;
    
    import javax.persistence.Id;
    import javax.persistence.Table;
    import javax.validation.constraints.NotEmpty;
    import javax.validation.constraints.NotNull;
    
    @ApiModel(value = "ÂàÜÁ±ªÂÆû‰ΩìÁ±ª")//swaggerÁöÑÊ≥®Ëß£ : Â£∞ÊòéÊ®°Âûã
    @Data
    @Table(name = "tb_category") //java ÁöÑÂÆû‰ΩìÁ±ªÂíåÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑË°®ÂÅöÊò†Â∞Ñ
    public class CategoryEntity {
    
        @Id //Â£∞Êòé‰∏ªÈîÆ
        @ApiModelProperty(value = "Á±ªÁõÆid",example = "1") //ÊâÄÊúâÁöÑÊï∞Â≠óÁ±ªÂûãÂú®ÂÜôswaggerÁöÑÊó∂ÂÄôÈúÄË¶ÅÂä†example="ÈªòËÆ§ÂÄº",ÊµãËØïÊé•Âè£
        @NotNull(message = "id‰∏çËÉΩ‰∏∫Á©∫", groups = {MingruiOperation.Update.class})
        private Integer id;//Â¶ÇÊûúÊ≤°Êúâ@Column ÈªòËÆ§‰ΩøÁî®entityÁöÑÂ±ûÊÄßÂêçÂíå Êï∞ÊçÆÂ∫ìË°®ÁöÑÂ≠óÊÆµÂêçÂÅöÊò†Â∞Ñ
    
        @ApiModelProperty(value = "Á±ªÁõÆÂêçÁß∞")
        @NotEmpty(message = "ÂàÜÁ±ªÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫", groups = {MingruiOperation.Add.class,MingruiOperation.Update.class})
        private String name;
    
        @ApiModelProperty(value = "Áà∂Á±ªÁõÆid,È°∂Á∫ßÁ±ªÁõÆÂ°´0",example = "1")
        @NotNull(message = "Áà∂Á∫ßÂàÜÁ±ª‰∏çËÉΩ‰∏∫null",groups = {MingruiOperation.Add.class})
        private Integer parentId;//‰ºöËá™Âä®Â∞ÜÈ©ºÂ≥∞ËΩ¨Êç¢‰∏∫ _xÁöÑÂΩ¢Âºè
    
        @ApiModelProperty(value = "ÊòØÂê¶ÊòØÁà∂Á∫ßËäÇÁÇπ",example = "1")
        @NotNull(message = "ÊòØÂê¶‰∏∫Áà∂Á∫ßËäÇÁÇπ‰∏çËÉΩ‰∏∫null",groups = {MingruiOperation.Add.class})
        private Integer isParent;
    
        @ApiModelProperty(value = "ÊéíÂ∫è",example = "1")
        @NotNull(message = "ÊéíÂ∫èÂ≠óÊÆµ‰∏çËÉΩ‰∏∫null",groups = {MingruiOperation.Add.class})
        private Integer sort;
    
    }
    ```

  - CategoryService

    ```java
    package com.baidu.shop.service;
    
    import com.baidu.shop.base.Result;
    import com.baidu.shop.entity.CategoryEntity;
    import com.baidu.shop.validate.group.MingruiOperation;
    import com.google.gson.JsonObject;
    import io.swagger.annotations.Api;
    import io.swagger.annotations.ApiOperation;
    import org.springframework.validation.annotation.Validated;
    import org.springframework.web.bind.annotation.*;
    
    import java.util.List;
    
    @Api(tags = "ÂïÜÂìÅÂàÜÁ±ªÊé•Âè£") // Â£∞ÊòéÊé•Âè£
    public interface CategoryService {
    
        @ApiOperation(value = "ÈÄöËøápidÊü•ËØ¢ÂïÜÂìÅÂàÜÁ±ª")
        @GetMapping(value = "category/list")
        Result<List<CategoryEntity>> getCategoryByPid(Integer pid);
    
        @ApiOperation(value = "ÈÄöËøáidËøõË°åÂàÜÁ±ªÂà†Èô§")
        @DeleteMapping(value = "/category/delete")
        Result<JsonObject> deleteCategoryById(Integer id);
    
    
        @ApiOperation(value = "ÂàÜÁ±ª‰øÆÊîπ")
        @PutMapping(value = "/category/edit")
        Result<JsonObject> putCategoryById(@Validated({MingruiOperation.Update.class}) @RequestBody CategoryEntity categoryEntity);
    
        @ApiOperation(value = "ÂàÜÁ±ªÊñ∞Â¢û")
        @PostMapping(value = "/category/save")
        Result<JsonObject> addCategoryEntity(@Validated({MingruiOperation.Add.class}) @RequestBody CategoryEntity categoryEntity);
    
    }
    ```

#### ÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜ

- mingrui-shop-common-core 

  - pom.xml

    ```java
    <!-- SpringBoot-Êï¥ÂêàWebÁªÑ‰ª∂ -->
    <dependency>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    ```

  - com.baidu.shop.status

    - HTTPStatus

      ```
      public static final int PARAMS_VALIDATE_ERROR = 5002;//ÂèÇÊï∞Ê†°È™åÂ§±Ë¥•
      ```

- Êñ∞Âª∫ÂåÖ com.baidu.shop.global

  - Êñ∞Âª∫ÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜÁ±ª GlobalException

    ```
    package com.baidu.shop.global;
    
    import com.alibaba.fastjson.JSONObject;
    import com.baidu.shop.base.Result;
    import com.baidu.shop.status.HTTPStatus;
    import com.google.gson.JsonObject;
    import lombok.extern.slf4j.Slf4j;
    import org.springframework.validation.FieldError;
    import org.springframework.web.bind.MethodArgumentNotValidException;
    import org.springframework.web.bind.annotation.ExceptionHandler;
    import org.springframework.web.bind.annotation.RestControllerAdvice;
    
    import java.util.*;
    import java.util.stream.Collector;
    import java.util.stream.Collectors;
    
    
    @RestControllerAdvice
    @Slf4j
    public class GlobalException {
    
        @ExceptionHandler(value = RuntimeException.class)
        public Result<JSONObject> testException(RuntimeException e){
            log.error("code : {} , message : {}",HTTPStatus.ERROR,e.getMessage());
            return new Result<JSONObject>(HTTPStatus.ERROR,e.getMessage(),null);
        }
        @ExceptionHandler(value= MethodArgumentNotValidException.class)
        public Map<String,Object> methodArgumentNotValidHandler(MethodArgumentNotValidException exception) throws Exception{
            HashMap<String, Object> map = new HashMap<>();
            map.put("code",HTTPStatus.PARAMS_VALIDATE_ERROR);
            List<String> msgList = new ArrayList<>();
            exception.getBindingResult().getFieldErrors().stream().forEach(error -> {
                msgList.add("Field --> " + error.getField() + " : " + error.getDefaultMessage());
                log.error("Field --> " + error.getField() + " : " + error.getDefaultMessage());
            });
            String message = msgList.parallelStream().collect(Collectors.joining(","));
            map.put("massage",message);
            return map;
        }
    
    }
    ```

#### Swagger

- mingrui-shop-service-api

  - pom.xml

    ```
    <dependencies>
            <!--Â∏ÆÂä©ÂºÄÂèë‰∫∫ÂëòÂø´ÈÄüÁîüÊàêAPIÊñáÊ°£-->
            <dependency>
                <groupId>io.springfox</groupId>
                <artifactId>springfox-swagger2</artifactId>
                <version>2.9.2</version>
            </dependency>
            <!--Êèê‰æõÂèØËßÜÂåñÁöÑAPIÊñáÊ°£-->
            <dependency>
                <groupId>io.springfox</groupId>
                <artifactId>springfox-swagger-ui</artifactId>
                <version>2.9.2</version>
            </dependency>
    </dependencies>
    ```

- mingrui-shop-service-api-xxx

  - Âú® com.baidu.shop ‰∏ãÊñ∞Âª∫ config ÂåÖ

  - Âú® config ÂåÖ‰∏ãÊñ∞Âª∫MrSwagger2Config

    ```
    package com.baidu.shop.config;
    
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    import springfox.documentation.builders.ApiInfoBuilder;
    import springfox.documentation.builders.PathSelectors;
    import springfox.documentation.builders.RequestHandlerSelectors;
    import springfox.documentation.service.ApiInfo;
    import springfox.documentation.service.Contact;
    import springfox.documentation.spi.DocumentationType;
    import springfox.documentation.spring.web.plugins.Docket;
    import springfox.documentation.swagger2.annotations.EnableSwagger2;
    
    @Configuration
    @EnableSwagger2
    public class MrSwagger2Config {
    
        @Bean
        public Docket createRestApi(){
            return new Docket(DocumentationType.SWAGGER_2)
                    .apiInfo(this.apiInfo())
                    .select()
                    .apis(RequestHandlerSelectors.basePackage("com.baidu"))
                    .paths(PathSelectors.any())
                    .build();
        }
    
        private ApiInfo apiInfo(){
            return new ApiInfoBuilder()
                    //Ê†áÈ¢ò
                    .title("ÊòéÁëûSWAGGER2Ê†áÈ¢ò")
                    //Êù°Ê¨æÂú∞ÂùÄ
                    .termsOfServiceUrl("http://www.baidu.com")
                    //ËÅîÁ≥ªÊñπÂºè-->ÊúâStringÂèÇÊï∞ÁöÑÊñπÊ≥ï‰ΩÜÊòØÂ∑≤ÁªèËøáÊó∂ÔºåÊâÄ‰ª•‰∏çÊé®Ëçê‰ΩøÁî®
                    .contact(new Contact("shenyaqi","baidu.com","shenyaqiii@163.com"))
                    //ÁâàÊú¨
                    .version("v1.0")
                    //È°πÁõÆÊèèËø∞
                    .description("ÊèèËø∞")
                    //ÂàõÂª∫APIÂü∫Êú¨‰ø°ÊÅØ
                    .build();
        }
    
    }
    ```

    

