# å•†å“åˆ†ç±»ç®¡ç†

### ğŸ’¨åˆ†ç±»æŸ¥è¯¢

#### 	1. mingrui-shop-common-core å·¥ç¨‹

- åœ¨ `mingrui-shop-commons` é¡¹ç›®ä¸‹æ–°å»º `mingrui-shop-common-core` é¡¹ç›®

  - pom.xml

    ```
     <dependencies>
            <!--å¤„ç†jsonä¸å„ç§æ•°æ®ç±»å‹æˆ–æ–‡æ¡£ç±»å‹çš„è½¬æ¢-->
            <dependency>
                <groupId>com.google.code.gson</groupId>
                <artifactId>gson</artifactId>
                <version>2.8.5</version>
            </dependency>
            <!--jsonå¯¹è±¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ”¯æŒ-->
            <dependency>
                <groupId>org.codehaus.jackson</groupId>
                <artifactId>jackson-core-lgpl</artifactId>
                <version>1.9.13</version>
            </dependency>
            <dependency>
                <groupId>org.codehaus.jackson</groupId>
                <artifactId>jackson-mapper-lgpl</artifactId>
                <version>1.9.13</version>
            </dependency>
            <!--javaå¯¹è±¡å’Œjsonå¯¹è±¡ä¹‹é—´çš„è½¬æ¢-->
            <dependency>
                <groupId>org.codehaus.jackson</groupId>
                <artifactId>jackson-core-asl</artifactId>
                <version>1.9.13</version>
            </dependency>
            <dependency>
                <groupId>org.codehaus.jackson</groupId>
                <artifactId>jackson-mapper-asl</artifactId>
                <version>1.9.13</version>
            </dependency>
    
            <!--alibabaçš„jsonå¤„ç†å·¥å…·-->
            <dependency>
                <groupId>com.alibaba</groupId>
                <artifactId>fastjson</artifactId>
                <version>1.2.62</version>
            </dependency>
            <dependency>
                <groupId>com.fasterxml.jackson.core</groupId>
                <artifactId>jackson-databind</artifactId>
                <version>2.11.2</version>
            </dependency>
        </dependencies>
    ```

  - æ–°å»ºåŒ… com.baidu.shop.utils

    - JSONUtil

      ```
      package com.baidu.shop.utils;
      
      import com.alibaba.fastjson.JSONObject;
      import org.codehaus.jackson.JsonParseException;
      import org.codehaus.jackson.map.JsonMappingException;
      import org.codehaus.jackson.map.ObjectMapper;
      import org.codehaus.jackson.type.TypeReference;
      import com.google.gson.Gson;
      import com.google.gson.GsonBuilder;
      import com.google.gson.JsonArray;
      import com.google.gson.JsonElement;
      import com.google.gson.JsonObject;
      import com.google.gson.JsonParser;
      import com.google.gson.reflect.TypeToken;
      
      import java.io.FileOutputStream;
      import java.io.IOException;
      import java.util.ArrayList;
      import java.util.HashMap;
      import java.util.List;
      import java.util.Map;
      
      public class JSONUtil {
      
          private static Gson gson = null;
      
          static {
              gson = new GsonBuilder().setDateFormat("yyyy-MM-dd HH:mm:ss").create();// todo yyyy-MM-dd HH:mm:ss
          }
      
          public static synchronized Gson newInstance() {
              if (gson == null) {
                  gson = new GsonBuilder().setDateFormat("yyyy-MM-dd HH:mm:ss").create();
              }
              return gson;
          }
      
          public static String toJsonString(Object obj) {
              return gson.toJson(obj);
          }
      
          public static <T> T toBean(String json, Class<T> clz) {
      
              return gson.fromJson(json, clz);
          }
      
          public static <T> Map<String, T> toMap(String json, Class<T> clz) {
              Map<String, JsonObject> map = gson.fromJson(json, new TypeToken<Map<String, JsonObject>>() {
              }.getType());
              Map<String, T> result = new HashMap<String, T>();
              for (String key : map.keySet()) {
                  result.put(key, gson.fromJson(map.get(key), clz));
              }
              return result;
          }
      
          public static Map<String, Object> toMap(String json) {
              Map<String, Object> map = gson.fromJson(json, new TypeToken<Map<String, Object>>() {
              }.getType());
              return map;
          }
      
          public static <T> List<T> toList(String json, Class<T> clz) {
              JsonArray array = new JsonParser().parse(json).getAsJsonArray();
              List<T> list = new ArrayList<T>();
              for (final JsonElement elem : array) {
                  list.add(gson.fromJson(elem, clz));
              }
              return list;
          }
      
          public static <T> Object getObjectByKey(String json, Class<T> clazz) {
              if (json != null && !"".equals(json)) {
                  return JSONObject.parseObject(json, clazz);
              }
              return null;
          }
      
          public static <T> List<T> getListByKey(String json, Class<T> clazz) {
              if (json != null && !"".equals(json)) {
                  return JSONObject.parseArray(json, clazz);
              }
              return null;
          }
          
          public static String getStrByKey(String json, String key) {
              String str = "";
              if (json != null && !"".equals(json)) {
                  JSONObject j = JSONObject.parseObject(json);
                  if (j.get(key) != null) {
                      str = j.get(key).toString();
                  }
              }
              return str;
          }
      
          public static void writeByFileOutputStream(String _sDestFile, String _sContent) throws IOException {
              FileOutputStream fos = null;
              try {
                  fos = new FileOutputStream(_sDestFile);
                  fos.write(_sContent.getBytes());
              } catch (Exception ex) {
                  ex.printStackTrace();
              } finally {
                  if (fos != null) {
                      fos.close();
                      fos = null;
                  }
      
              }
          }
      
          public static boolean noEmpty(String str) {
              boolean flag = true;
              if ("".equals(str)) {
                  flag = false;
              }
              return flag;
          }
      
          public static double getDecimalByPercentage(String str) {
              double fuse = 0.0;
              if (!"".equals(str) && str != null) {
                  if (str.split("%").length > 0) {
                      fuse = Double.parseDouble(str.split("%")[0]);
                      return fuse;
                  }
              }
              return 0.0;
          }
      
          public static double ConversionFraction(double number) {
              return Math.floor(number * 100 + 0.5) / 100;
          }
      
          public static float ConversionM(double number) {
              return (float) JSONUtil.ConversionFraction(number / 1024 / 1024);
          }
      
          public static String getErrorText(String s) {
              JSONObject j = JSONObject.parseObject(s);
              return j.getJSONObject(j.keySet().iterator().next()).get("errortext").toString();
          }
      
          public static String getSingleJobId(String s) throws Exception {
              JSONObject j = JSONObject.parseObject(s);
              try {
                  return j.getJSONObject(j.keySet().iterator().next()).get("jobid").toString();
              } catch (Exception e) {
                  try {
                      return j.getJSONObject(j.keySet().iterator().next()).get("errortext").toString();
                  } catch (Exception e1) {
                      throw new Exception(e1.getMessage());
      
                  }
      
              }
          }
      
          public static <T> T readValue(String jsonStr, TypeReference type)
                  throws JsonParseException, JsonMappingException, IOException {
              ObjectMapper mapper = new ObjectMapper();
              return mapper.readValue(jsonStr, type);
          }
      
          public static JSON_TYPE getJSONType(String str) {
              if (null == str || "".equals(str)) {
                  return JSON_TYPE.JSON_TYPE_ERROR;
              }
      
              final char[] strChar = str.substring(0, 1).toCharArray();
              final char firstChar = strChar[0];
      
              if (firstChar == '{') {
                  return JSON_TYPE.JSON_TYPE_OBJECT;
              } else if (firstChar == '[') {
                  return JSON_TYPE.JSON_TYPE_ARRAY;
              } else {
                  return JSON_TYPE.JSON_TYPE_ERROR;
              }
          }
      
          public enum JSON_TYPE {
              /** JSONObject */
              JSON_TYPE_OBJECT,
              /** JSONArray */
              JSON_TYPE_ARRAY,
              /** ä¸æ˜¯JSONæ ¼å¼çš„å­—ç¬¦ä¸² */
              JSON_TYPE_ERROR
          }
      }
      
      ```

  -  æ–°å»ºåŒ… com.baidu.shop.status

    - HTTPStatus

      ```
      package com.baidu.shop.status;
      
      public class HTTPStatus {
      
          public static final int OK = 200;//æˆåŠŸ
      
          public static final int ERROR = 500;//å¤±è´¥
      
      }
      ```

  - æ–°å»ºåŒ… com.baidu.shop.base

    - Result

      ```
      package com.baidu.shop.base;
      
      import lombok.Data;
      import lombok.NoArgsConstructor;
      
      @Data // ç”Ÿæˆset å’Œgetå‡½æ•°
      @NoArgsConstructor //ç”Ÿæˆæ— å‚æ„é€ å‡½æ•°
      public class Result<T> {
      
          private Integer code;//è¿”å›ç ,
      
          private String message;//è¿”å›æ¶ˆæ¯
      
          private T data;//è¿”å›æ•°æ®
      
          public Result(Integer code, String message, Object data) {
              this.code = code;
              this.message = message;
              this.data = (T) data;
          }
      }
      ```

    - BaseApiService

      ```
      package com.baidu.shop.base;
      
      import com.baidu.shop.status.HTTPStatus;
      import com.baidu.shop.utils.JSONUtil;
      import lombok.Data;
      import lombok.extern.slf4j.Slf4j;
      import org.apache.commons.logging.Log;
      import org.apache.commons.logging.LogFactory;
      import org.springframework.stereotype.Component;
      
      @Data
      @Component
      @Slf4j
      public class BaseApiService<T> {
      
          public Result<T> setResultError(Integer code, String msg) {
              return setResult(code, msg, null);
          }
      
          // è¿”å›é”™è¯¯ï¼Œå¯ä»¥ä¼ msg
          public Result<T> setResultError(String msg) {
      
              return setResult(HTTPStatus.ERROR, msg, null);
          }
      
          // è¿”å›æˆåŠŸï¼Œå¯ä»¥ä¼ dataå€¼
          public Result<T> setResultSuccess(T data) {
              return setResult(HTTPStatus.OK, HTTPStatus.OK + "", data);
          }
      
          // è¿”å›æˆåŠŸï¼Œæ²’æœ‰dataå€¼
          public Result<T> setResultSuccess() {
              return setResult(HTTPStatus.OK, HTTPStatus.OK + "", null);
          }
      
          // è¿”å›æˆåŠŸï¼Œæ²’æœ‰dataå€¼
          public Result<T> setResultSuccess(String msg) {
              return setResult(HTTPStatus.OK, msg, null);
          }
      
          // é€šç”¨å°è£…
          public Result<T> setResult(Integer code, String msg, T data) {
              log.info(String.format("{code : %s , msg : %s , data : %s}",code,msg, JSONUtil.toJsonString(data)));
              return new Result<T>(code, msg, data);
          }
      
      }
      ```

#### 2. service-api å·¥ç¨‹

- `mingrui-shop-service-api` 

  - pom.xml

    ```
       <!--Entity ä¸­çš„@Table å’Œ@Idéœ€è¦æ­¤æ³¨è§£-->
            <dependency>
                <groupId>javax.persistence</groupId>
                <artifactId>persistence-api</artifactId>
                <version>1.0.2</version>
            </dependency>
    
            <!--2.3ç‰ˆæœ¬ä¹‹åwebåˆ é™¤äº†éªŒè¯æ’ä»¶-->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-validation</artifactId>
            </dependency>
    
            <!--å¼•å…¥commonå·¥ç¨‹ä»£ç  æŠŠå¾®æœåŠ¡çš„è¿™ä¸ªæ¦‚å¿µåšåˆ°æè‡´   è®©æ¨¡å—(æœåŠ¡) å¤ç”¨-->
            <dependency>
                <groupId>com.baidu</groupId>
                <artifactId>mingrui-shop-common-core</artifactId>
                <version>1.0-SNAPSHOT</version>
            </dependency>
    ```

#### 3. åœ¨ mingrui-shop-service-api é¡¹ç›®ä¸‹

- ##### æ–°å»º mingrui-shop-service-api-xxx é¡¹ç›®
  - pom.xml

  ```
   <dependencies>
          <!--å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿç”ŸæˆAPIæ–‡æ¡£-->
          <dependency>
              <groupId>io.springfox</groupId>
              <artifactId>springfox-swagger2</artifactId>
              <version>2.9.2</version>
          </dependency>
          <!--æä¾›å¯è§†åŒ–çš„APIæ–‡æ¡£-->
          <dependency>
              <groupId>io.springfox</groupId>
              <artifactId>springfox-swagger-ui</artifactId>
              <version>2.9.2</version>
          </dependency>
      </dependencies>
  ```

  - æ–°å»ºåŒ… com.baidu.shop.entity

    - CategoryEntity

      ```
      package com.baidu.shop.entity;
      
      import com.baidu.shop.validate.group.MingruiOperation;
      import io.swagger.annotations.ApiModel;
      import io.swagger.annotations.ApiModelProperty;
      import lombok.Data;
      
      import javax.persistence.Id;
      import javax.persistence.Table;
      import javax.validation.constraints.NotEmpty;
      import javax.validation.constraints.NotNull;
      
      @ApiModel(value = "åˆ†ç±»å®ä½“ç±»")//swaggerçš„æ³¨è§£ : å£°æ˜æ¨¡å‹
      @Data
      @Table(name = "tb_category") //java çš„å®ä½“ç±»å’Œæ•°æ®åº“ä¸­çš„è¡¨åšæ˜ å°„
      public class CategoryEntity {
      
          @Id //å£°æ˜ä¸»é”®
          @ApiModelProperty(value = "ç±»ç›®id",example = "1") //æ‰€æœ‰çš„æ•°å­—ç±»å‹åœ¨å†™swaggerçš„æ—¶å€™éœ€è¦åŠ example="é»˜è®¤å€¼",æµ‹è¯•æ¥å£
          private Integer id;//å¦‚æœæ²¡æœ‰@Column é»˜è®¤ä½¿ç”¨entityçš„å±æ€§åå’Œ æ•°æ®åº“è¡¨çš„å­—æ®µååšæ˜ å°„
      
          @ApiModelProperty(value = "ç±»ç›®åç§°")
          private String name;
      
          @ApiModelProperty(value = "çˆ¶ç±»ç›®id,é¡¶çº§ç±»ç›®å¡«0",example = "1")
          private Integer parentId;//ä¼šè‡ªåŠ¨å°†é©¼å³°è½¬æ¢ä¸º _xçš„å½¢å¼
      
          @ApiModelProperty(value = "æ˜¯å¦æ˜¯çˆ¶çº§èŠ‚ç‚¹",example = "1")
          private Integer isParent;
      
          @ApiModelProperty(value = "æ’åº",example = "1")
          private Integer sort;
      
      }
      ```

  - æ–°å»ºåŒ… com.baidu.shop.config 

    - MrSwagger2Config

      ```
      package com.baidu.shop.config;
      
      import org.springframework.context.annotation.Bean;
      import org.springframework.context.annotation.Configuration;
      import springfox.documentation.builders.ApiInfoBuilder;
      import springfox.documentation.builders.PathSelectors;
      import springfox.documentation.builders.RequestHandlerSelectors;
      import springfox.documentation.service.ApiInfo;
      import springfox.documentation.service.Contact;
      import springfox.documentation.spi.DocumentationType;
      import springfox.documentation.spring.web.plugins.Docket;
      import springfox.documentation.swagger2.annotations.EnableSwagger2;
      
      @Configuration
      @EnableSwagger2
      public class MrSwagger2Config {
      
          @Bean
          public Docket createRestApi(){
              return new Docket(DocumentationType.SWAGGER_2)
                      .apiInfo(this.apiInfo())
                      .select()
                      .apis(RequestHandlerSelectors.basePackage("com.baidu"))
                      .paths(PathSelectors.any())
                      .build();
          }
      
          private ApiInfo apiInfo(){
              return new ApiInfoBuilder()
                      //æ ‡é¢˜
                      .title("æ˜ç‘SWAGGER2æ ‡é¢˜")
                      //æ¡æ¬¾åœ°å€
                      .termsOfServiceUrl("http://www.baidu.com")
                      //è”ç³»æ–¹å¼-->æœ‰Stringå‚æ•°çš„æ–¹æ³•ä½†æ˜¯å·²ç»è¿‡æ—¶ï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨
                      .contact(new Contact("shenyaqi","baidu.com","shenyaqiii@163.com"))
                      //ç‰ˆæœ¬
                      .version("v1.0")
                      //é¡¹ç›®æè¿°
                      .description("æè¿°")
                      //åˆ›å»ºAPIåŸºæœ¬ä¿¡æ¯
                      .build();
          }
      }
      ```

- #####  å®šä¹‰å•†å“åˆ†ç±»æ¥å£
  - æ–°å»ºåŒ… com.baidu.shop.service

    - CategoryService 

    ```
    package com.baidu.shop.service;
    
    import com.baidu.shop.base.Result;
    import com.baidu.shop.entity.CategoryEntity;
    import com.baidu.shop.validate.group.MingruiOperation;
    import com.google.gson.JsonObject;
    import io.swagger.annotations.Api;
    import io.swagger.annotations.ApiOperation;
    import org.springframework.validation.annotation.Validated;
    import org.springframework.web.bind.annotation.*;
    
    import java.util.List;
    
    @Api(tags = "å•†å“åˆ†ç±»æ¥å£") // å£°æ˜æ¥å£
    public interface CategoryService {
    
        @ApiOperation(value = "é€šè¿‡pidæŸ¥è¯¢å•†å“åˆ†ç±»")
        @GetMapping(value = "category/list")
        Result<List<CategoryEntity>> getCategoryByPid(Integer pid);
    
    }
    ```

#### 4. mingrui-shop-service å·¥ç¨‹

- pom.xml

  ```
    <dependencies>
          <!-- SpringBoot-æ•´åˆWebç»„ä»¶ -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-web</artifactId>
          </dependency>
          <!-- springcloud feignç»„ä»¶ -->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-openfeign</artifactId>
          </dependency>
          <!--mysqlæ•°æ®åº“è¿æ¥-->
          <dependency>
              <groupId>mysql</groupId>
              <artifactId>mysql-connector-java</artifactId>
              <scope>runtime</scope><!--é¡¹ç›®è¿è¡Œé˜¶æ®µä½¿ç”¨-->
          </dependency>
          <!--é€šç”¨mapper-->
          <dependency>
              <groupId>tk.mybatis</groupId>
              <artifactId>mapper-spring-boot-starter</artifactId>
              <version>2.1.5</version>
          </dependency>
  
          <!--åˆ†é¡µå·¥å…·
          è‡ªå®šä¹‰çš„ mybatis æ’ä»¶
          mybatisè¿è¡ŒåŸç† mybatisçš„æ‰§è¡Œå™¨-->
          <dependency>
              <groupId>com.github.pagehelper</groupId>
              <artifactId>pagehelper-spring-boot-starter</artifactId>
              <version>1.2.10</version>
          </dependency>
  
          <dependency>
              <groupId>com.baidu</groupId>
              <artifactId>mingrui-shop-service-api-xxx</artifactId>
              <version>1.0-SNAPSHOT</version>
          </dependency>
      </dependencies>
  ```

- ##### åœ¨ mingrui-shop-service å·¥ç¨‹ä¸‹æ–°å»º mingrui-shop-service-xxx å·¥ç¨‹

  - application.yml

    ```
    server:
      port: 8100
    
    spring:
      application:
        name: xxx-server
      # é…ç½®æ•°æ®æº
      datasource:
        # æ•°æ®æºåç§°ï¼Œä»»æ„
        name: mysql
        url: jdbc:mysql://localhost:3306/2006?useSSL=true&nullNamePatternMatchesAll=true&serverTimezone=GMT%2B8&useUnicode=true&characterEncoding=utf8
        # æ•°æ®åº“è¿æ¥ç”¨æˆ·
        username: root
        # æ•°æ®åº“è¿æ¥å¯†ç 
        password: root
        # é©±åŠ¨åç§°
        driver-class-name: com.mysql.cj.jdbc.Driver
        # boot2.0+ä½¿ç”¨hikariä½œä¸ºé»˜è®¤æ•°æ®åº“è¿æ¥æ± 
        type: com.zaxxer.hikari.HikariDataSource
        hikari:
          # æ˜¯å¦è‡ªåŠ¨æäº¤äº‹åŠ¡ é»˜è®¤
          auto-commit: true
          # å…è®¸çš„æœ€å°è¿æ¥æ•°
          minimum-idle: 5
          # è¿æ¥æ± å†…æœ€å¤§è¿æ¥æ•°
          maximum-pool-size: 10
          # éªŒè¯è¿æ¥çš„sqlè¯­å¥
          connection-test-query: SELECT 1 FROM DUAL
          # è¿æ¥è¶…æ—¶æ—¶é—´ é»˜è®¤30000 æ¯«ç§’ å¦‚æœå°äº250æ¯«ç§’ï¼Œåˆ™è¢«é‡ç½®å›30ç§’
          connection-timeout: 30000
          # éªŒè¯è¶…æ—¶æ—¶é—´é»˜è®¤5000æ¯«ç§’ å¦‚æœå°äº250æ¯«ç§’ï¼Œåˆ™ä¼šè¢«é‡ç½®å›5ç§’
          validation-timeout: 5000
          # è®¾ç½®è¿æ¥åœ¨è¿æ¥æ± ä¸­çš„å­˜æ´»æ—¶é—´ å¦‚æœä¸ç­‰äº0ä¸”å°äº30ç§’åˆ™ä¼šè¢«é‡ç½®å›30åˆ†é’Ÿ
          max-lifetime: 1800000
    # é€šç”¨mapper
    mapper:
      mappers: tk.mybatis.mapper.common.Mapper
      identity: MYSQL
    #æ—¥å¿—è®¾ç½®
    logging:
      level:
        # æ‰“å°ä¸æˆ‘ä»¬ç¨‹åºç›¸å…³çš„æ—¥å¿—ä¿¡æ¯
        com.baidu.shop: debug
    # eurekaé…ç½®
    eureka:
      client:
        service-url:
          defaultZone: http://localhost:8761/eureka/
    ```

- æ–°å»ºåŒ… com.baidu

  - æ–°å»ºå¯åŠ¨ç±» `RunXXXApplication`

    ```
    package com.baidu;
    
    import org.springframework.boot.SpringApplication;
    import org.springframework.boot.autoconfigure.SpringBootApplication;
    import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
    import tk.mybatis.spring.annotation.MapperScan;
    
    @SpringBootApplication
    @EnableEurekaClient
    @MapperScan("com.baidu.shop.mapper")
    public class RunXXXApplication {
        public static void main(String[] args) {
            SpringApplication.run(RunXXXApplication.class);
        }
    }
    ```

- åœ¨ com.baidu ä¸‹æ–°å»ºåŒ… shop.mapper

  - åˆ›å»ºæ¥å£ CategoryMapper

    ```
    package com.baidu.shop.mapper;
    
    import com.baidu.shop.entity.CategoryEntity;
    import org.apache.ibatis.annotations.Select;
    import tk.mybatis.mapper.additional.idlist.SelectByIdListMapper;
    import tk.mybatis.mapper.common.Mapper;
    
    import java.util.List;
    
    public interface CategoryMapper extends Mapper<CategoryEntity>{
    
    }
    ```

- åœ¨ com.baidu ä¸‹æ–°å»ºåŒ… shop.service.impl

  - æ–°å»ºå®ç°ç±» `CategoryServiceImpl` 

    ```
    package com.baidu.shop.service.impl;
    
    import com.baidu.shop.base.BaseApiService;
    import com.baidu.shop.base.Result;
    import com.baidu.shop.entity.CategoryBrandEntity;
    import com.baidu.shop.entity.CategoryEntity;
    import com.baidu.shop.mapper.CategoryBrandMapper;
    import com.baidu.shop.mapper.CategoryMapper;
    import com.baidu.shop.service.CategoryService;
    import com.baidu.shop.utils.ObjectUtil;
    import com.google.gson.JsonObject;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.transaction.annotation.Transactional;
    import org.springframework.web.bind.annotation.RestController;
    import tk.mybatis.mapper.entity.Example;
    
    import java.util.List;
    
    
    @RestController
    public class CategoryServiceImpl extends BaseApiService implements CategoryService{
    
        @Autowired
        private CategoryMapper categoryMapper;
    
    
        @Override
        public Result<List<CategoryEntity>> getCategoryByPid(Integer pid) {
            CategoryEntity categoryEntity = new CategoryEntity();
            categoryEntity.setParentId(pid);
            List<CategoryEntity> list = categoryMapper.select(categoryEntity);
            return this.setResultSuccess(list);
        }
        
    }
    ```

- ##### æµè§ˆå™¨è¾“å…¥

  ```
  http://localhost:8100/category/list
  ```

  ![](E:\æ·˜å®é¡¹ç›®\image\screenshot_20210106_153206.png)

#### 5. ç½‘å…³æœåŠ¡

- åœ¨ mingrui-shop-basic é¡¹ç›®ä¸‹

  - æ–°å»º mingrui-shop-basic-zuul-server

    - pom.xml

      ```
      <dependencies>
              <!-- zuul -->
              <dependency>
                  <groupId>org.springframework.cloud</groupId>
                  <artifactId>spring-cloud-starter-netflix-zuul</artifactId>
              </dependency>
      
          </dependencies>
      ```

    - application.yml

      ```
      server:
        port: 8088
      
      spring:
        application:
          name: eureka-zuul
      
      zuul:
        # å£°æ˜è·¯ç”±
        routes:
          # è·¯ç”±åç§°
          api-xxx:
            # å£°æ˜å°†æ‰€æœ‰ä»¥/api-ribbon/çš„è¯·æ±‚éƒ½è½¬å‘åˆ°eureka-ribbonçš„æœåŠ¡ä¸­
            path: /api-xxx/**
            serviceId: xxx-server
        # å¯ç”¨é‡è¯•
        retryable: true
        # åŒ…å«æ­¤è·¯å¾„çš„ä¸è¿›è¡Œè·¯ç”±
        ignored-patterns: /upload/**
        # å¿½ç•¥ä¸Šä¼ æœåŠ¡
        ignored-services:
          -upload-server
      #é…ç½®è´Ÿè½½
      ribbon:
        ConnectTimeout: 250 # è¿æ¥è¶…æ—¶æ—¶é—´(ms)
        ReadTimeout: 2000 # é€šä¿¡è¶…æ—¶æ—¶é—´(ms)
        OkToRetryOnAllOperations: true # æ˜¯å¦å¯¹æ‰€æœ‰æ“ä½œé‡è¯•
        MaxAutoRetriesNextServer: 2 # åŒä¸€æœåŠ¡ä¸åŒå®ä¾‹çš„é‡è¯•æ¬¡æ•°
        MaxAutoRetries: 1 # åŒä¸€å®ä¾‹çš„é‡è¯•æ¬¡æ•°
      
      hystrix:
        command:
          default:
            execution:
              isolation:
                thread:
                  timeoutInMilliseconds: 10000 # ç†”æ–­è¶…æ—¶æ—¶é•¿ï¼š6000ms
      
      eureka:
        client:
          service-url:
            defaultZone: http://localhost:8761/eureka/
      ```

  - æ–°å»ºåŒ… com.baidu

    - æ–°å»ºå¯åŠ¨ç±» RunZuulServerApplication 

      ```
      package com.baidu;
      
      import org.springframework.boot.SpringApplication;
      import org.springframework.boot.autoconfigure.SpringBootApplication;
      import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
      import org.springframework.cloud.netflix.zuul.EnableZuulProxy;
      
      @SpringBootApplication
      @EnableZuulProxy
      @EnableEurekaClient
      public class RunZuulServerApplication {
          public static void main(String[] args) {
              SpringApplication.run(RunZuulServerApplication.class);
          }
      }
      ```

  - æ–°å»ºåŒ… com.baidu.global

    - æ–°å»ºç±» GlobalCorsConfig

      ```
      package com.baidu.global;
      
      import org.springframework.context.annotation.Bean;
      import org.springframework.context.annotation.Configuration;
      import org.springframework.web.cors.CorsConfiguration;
      import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
      import org.springframework.web.filter.CorsFilter;
      
      @Configuration
      public class GlobalCorsConfig {
          @Bean
          public CorsFilter corsFilter() {
      
              final UrlBasedCorsConfigurationSource source = new  UrlBasedCorsConfigurationSource();
      
              final CorsConfiguration config = new CorsConfiguration();
      
              config.setAllowCredentials(true); // å…è®¸cookiesè·¨åŸŸ
      
              config.addAllowedOrigin("*");// å…è®¸å‘è¯¥æœåŠ¡å™¨æäº¤è¯·æ±‚çš„URIï¼Œ*è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚
              // è¿™é‡Œå°½é‡é™åˆ¶æ¥æºåŸŸï¼Œæ¯”å¦‚http://xxxx:8080 ,ä»¥é™ä½å®‰å…¨é£é™©ã€‚ã€‚
      
              config.addAllowedHeader("*");// å…è®¸è®¿é—®çš„å¤´ä¿¡æ¯,*è¡¨ç¤ºå…¨éƒ¨
              config.setMaxAge(18000L);// é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå³åœ¨è¿™ä¸ªæ—¶é—´æ®µé‡Œï¼Œå¯¹äºç›¸åŒ  çš„è·¨åŸŸè¯·æ±‚ä¸ä¼šå†é¢„æ£€äº†
              config.addAllowedMethod("*");// å…è®¸æäº¤è¯·æ±‚çš„æ–¹æ³•ï¼Œ*è¡¨ç¤ºå…¨éƒ¨å…è®¸ï¼Œä¹Ÿå¯ä»¥å•ç‹¬è®¾  ç½®GETã€PUTç­‰
              config.addAllowedMethod("HEAD");
              config.addAllowedMethod("GET");// å…è®¸Getçš„è¯·æ±‚æ–¹æ³•
              config.addAllowedMethod("PUT");
              config.addAllowedMethod("POST");
              config.addAllowedMethod("DELETE");
              config.addAllowedMethod("PATCH");
              source.registerCorsConfiguration("/**", config);
      
              //3.è¿”å›æ–°çš„CorsFilter.
              return new CorsFilter(source);
          }
      }
      ```

      ![](E:\æ·˜å®é¡¹ç›®\image\screenshot_20210106_153825.png)

#### 6. vue é¡¹ç›®

- ##### Category.vue

  <img src="E:\æ·˜å®é¡¹ç›®\image\screenshot_20210106_154240.png" style="zoom:50%;" />

<img src="E:\æ·˜å®é¡¹ç›®\image\screenshot_20210106_154320.png" style="zoom: 50%;" />

â€‹			

```
<template>
  <v-card>
      <v-flex xs12 sm10>
        <v-tree url="/category/list"
                :isEdit="isEdit"
                :key="delKey"
                @handleAdd="handleAdd"
                @handleEdit="handleEdit"
                @handleDelete="handleDelete"
                @handleClick="handleClick"
        />
      </v-flex>
  </v-card>
</template>
<script>
 // import {treeData} from '../../mockDB'
  export default {
    name: "category",
    data() {
      return {
        isEdit:true,
        //åˆ·æ–°
        delKey:0,
      }
    },
    methods: {
      handleAdd(node) {
        node.isParent = node.isParent?1:0;
        delete node.id;
        //æ–°å¢
        this.$http.post('/category/add',node).then(resp =>{     

          if(resp.data.code != 200){
            this.$message.error('æ–°å¢å¤±è´¥');
            return ;
          }
          this.$message.success('æ–°å¢æˆåŠŸ');
          this.delKey = new Date().getTime();

        }).catch(error => console.log(error))
      },
      //ä¿®æ”¹
      handleEdit(id, name) {
       this.$http.put('/category/update',{
         id:id,
         name:name
       }).then(resp => {
         if(resp.data.code != 200){
            this.$message.error('ä¿®æ”¹å¤±è´¥:' + resp.data.message);
            return ;
          }
          this.delKey = new Date().getTime();
          this.$message.success('ä¿®æ”¹æˆåŠŸ');
       }).catch(error => console.log(error))
      },
      //åˆ é™¤
     handleDelete(id) {
        this.$http.delete('/category/delete?id=' + id).then(resp => {
          if(resp.data.code != 200){
            this.$message.error('åˆ é™¤å¤±è´¥:' + resp.data.message);
            return ;
          }
          this.delKey = new Date().getTime();
          this.$message.success('åˆ é™¤æˆåŠŸ');
          //ç®­å¤´å‡½æ•°çš„å‚æ•°å¦‚æœåªæœ‰ä¸€ä¸ª é‚£ä¹ˆ() å¯ä»¥ä¸å†™
          //ç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“ä¸­åªæœ‰ä¸€è¡Œä»£ç {}å¯ä»¥ä¸å†™
        }).catch(error => console.log(error))
      },
      handleClick(node) {
        console.log(node)
      }
    }
  };
</script>
<style scoped>
</style>
```

- ##### Tree.vue

  - getDataæ–¹æ³•é‡æ–°åˆ¶å®š resp å›è°ƒ

    ```
    <template>
      <v-list class="pt-0 pb-0" dense>
        <TreeItem
          class="item" :model="model" v-for="(model, index) in db" :key="index"
          :url="url"
          :isEdit="isEdit"
          :nodes="nodes"
          @handleAdd="handleAdd"
          @handleEdit="handleEdit"
          @handleDelete="handleDelete"
          @handleClick="handleClick"
        />
      </v-list>
    </template>
    <script>
      import TreeItem from './TreeItem';
      export default {
        name: "vTree",
        props: {
          url: String,
          isEdit: {
            type: Boolean,
            default: false
          },
          treeData:{
            type:Array
          }
        },
        data() {
          return {
            db: [],
            nodes:{
              opened:null,
              selected:{isSelected:false}
            }
          }
        },
        components: {
          TreeItem
        },
        created() {
          if(this.treeData && this.treeData.length > 0){
            this.db = this.treeData;
            return;
          }
          this.getData();
        },
        methods: {
          getData() {
            //åŠ è½½ä¸€çº§èœå•
            this.$http.get(this.url, {params: {pid: 0}}).then(resp => {
              //æ˜¾ç¤º
              this.db = resp.data.data;
              this.db.forEach(n => n['path'] = [n.name])
            })
          },
          handleAdd(node) {
            this.$emit("handleAdd", this.copyNodeInfo(node));
          },
          handleEdit(id, name) {
            this.$emit("handleEdit", id, name)
          },
          handleDelete(id) {
            this.deleteById(id, this.db);
            this.$emit("handleDelete", id);
          },
          handleClick(node){
            this.$emit("handleClick", this.copyNodeInfo(node))
          },
          // æ ¹æ®idåˆ é™¤
          deleteById(id, arr) {
            let src = arr || this.db;
            for (let i in src) {
              let d = src[i];
              if (d.id === id) {
                src.splice(i, 1)
                return;
              }
              if (d.children && d.children.length > 0) {
                this.deleteById(id, d.children)
              }
            }
          },
          copyNodeInfo(node){
            const o = {};
            for(let i in node){
              o[i] = node[i];
            }
            return o;
          }
        },
        watch: {}
      }
    </script>
    
    <style scoped>
      .item {
        cursor: pointer;
      }
    </style>
    ```

- ##### Treeltem.vue

  - line:126 ä¿®æ”¹å›è°ƒ

    ```
    <template>
      <div>
        <v-list-tile
          @click="toggle" class="level1 pt-0 pb-0 mt-0 mb-0" :class="{'selected':isSelected}">
          <v-list-tile-avatar>
            <v-icon v-if="model.isParent">{{open ? 'folder_open' : 'folder'}}</v-icon>
            <v-icon v-if="!model.isParent">insert_drive_file</v-icon>
          </v-list-tile-avatar>
          <v-list-tile-content>
            <v-list-tile-title v-show="!beginEdit">
              <span >{{model.name}}</span>
            </v-list-tile-title>
            <input v-show="beginEdit" @click.stop="" :ref="model.id" v-model="model.name"
                   @blur="afterEdit" @keydown.enter="afterEdit"/>
          </v-list-tile-content>
          <v-list-tile-action v-if="isEdit">
            <v-btn icon @mouseover="c1='primary'" @mouseout="c1=''" :color="c1" @click.stop="addChild">
              <i class="el-icon-plus"/>
            </v-btn>
          </v-list-tile-action>
          <v-list-tile-action v-if="isEdit">
            <v-btn icon @mouseover="c2='success'" @mouseout="c2=''" :color="c2" @click.stop="editChild">
              <i class="el-icon-edit"/>
            </v-btn>
          </v-list-tile-action>
          <v-list-tile-action v-if="isEdit">
            <v-btn icon @mouseover="c3='error'" @mouseout="c3=''" :color="c3" @click.stop="deleteChild">
              <i class="el-icon-delete"/>
            </v-btn>
          </v-list-tile-action>
        </v-list-tile>
    
        <v-list v-if="isFolder" v-show="open" class="ml-4 pt-0 pb-0" dense transition="scale-transition">
          <tree-item
            class="item"
            v-for="(model, index) in model.children"
            :key="index"
            :model="model"
            :url="url"
            :isEdit="isEdit"
            :nodes="nodes"
            :parentState="open"
            @handleAdd="handleAdd"
            @handleEdit="handleEdit"
            @handleDelete="handleDelete"
            @handleClick="handleClick"
          >
          </tree-item>
        </v-list>
      </div>
    </template>
    
    <script>
      import Vue from 'vue'
    
      export default {
        name: "tree-item",
        props: {
          model: Object,
          url: String,
          isEdit: {
            type: Boolean,
            default: false
          },
          nodes: Object,
          parentState:Boolean
        },
        created() {
        },
        data: function () {
          return {
            c1: '',
            c2: '',
            c3: '',
            isSelected: false,
            open:false,
            beginEdit:false
          }
        },
        watch:{
          parentState(val){
            if(!val){
              this.open = val;
            }
          }
        },
        computed: {
          isFolder: function () {
            return this.model.children &&
              this.model.children.length > 0
          }
        },
        methods: {
          toggle: function () {
            // å°†å…¶å®ƒè¢«é€‰ä¸­é¡¹å–æ¶ˆé€‰ä¸­
            this.nodes.selected.isSelected = false;
            // å½“å‰é¡¹è¢«é€‰ä¸­
            this.isSelected = true;
            // ä¿å­˜å½“å‰é€‰ä¸­é¡¹
            this.nodes.selected = this
    
            // å®¢æˆ·è‡ªå·±çš„ç‚¹å‡»äº‹ä»¶å›è°ƒ
            this.handleClick(this.model);
    
            // åˆ¤æ–­æ˜¯å¦ä¸ºé¡¶çº§èŠ‚ç‚¹ï¼Œé¡¶çº§èŠ‚ç‚¹éœ€è¦è®°å½•å’Œæ›¿æ¢
            if(this.model.parentId == 0){
              // åˆ¤æ–­æ‰“å¼€èŠ‚ç‚¹æ˜¯å¦æ˜¯è‡ªå·±
              if(this.nodes.opened && this != this.nodes.opened){
                // ä¸æ˜¯ï¼Œåˆ™å…³é—­åŸæ¥çš„èŠ‚ç‚¹
                this.nodes.opened.open = false;
              }
              // å°†è‡ªå·±è®°å½•ä¸ºæ‰“å¼€çš„èŠ‚ç‚¹
              this.nodes.opened = this;
            }
            // åˆ‡æ¢å¼€é—­çŠ¶æ€
            this.open = !this.open;
            // å¦‚æœå·²ç»æ˜¯å¶å­èŠ‚ç‚¹,æˆ–è€…è‡ªå·±æ˜¯å…³é—­çš„ï¼Œæˆ–è€…è‡ªå·±å·²ç»æœ‰å„¿å­äº†ï¼Œç»“æŸ
            if (!this.model.isParent || this.isFolder || !this.open) {
              return;
            }
            // å±•å¼€åæŸ¥è¯¢å­èŠ‚ç‚¹
            //ç‚¹å‡»çˆ¶èŠ‚ç‚¹ä¿¡æ¯å›è°ƒ
            this.$http.get(this.url, {params: {pid: this.model.id}})
              .then(resp => {
                //æ˜¾ç¤º
              Vue.set(this.model, 'children', resp.data.data);
              // å°è£…å½“å‰èŠ‚ç‚¹çš„è·¯å¾„
              this.model.children.forEach(n => {
                n['path'] = [];
                this.model.path.forEach(p => n['path'].push(p));
                n['path'].push(n.name);
              });
            }).catch( e => {
              console.log(e);
            });
          },
          addChild: function () {
            let child = {
              id: 0,
              name: 'æ–°çš„èŠ‚ç‚¹',
              parentId: this.model.id,
              isParent: false,
              sort:this.model.children? this.model.children.length + 1:1
            }
            if (!this.model.isParent) {
              Vue.set(this.model, 'children', [child]);
              this.model.isParent = true;
              this.open = true;
              this.handleAdd(child);
            } else {
              if (!this.isFolder) {
                this.$http.get(this.url, {params: {pid: this.model.id}}).then(resp => {
                  Vue.set(this.model, 'children', resp.data);
                  this.model.children.push(child);
                  this.open = true;
                  this.handleAdd(child);
                });
              } else {
                this.model.children.push(child);
                this.open = true;
                this.handleAdd(child);
              }
            }
          },
          deleteChild: function () {
    
            //åˆ é™¤
            //åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºçˆ¶èŠ‚ç‚¹ isParent == 1
            //æ§åˆ¶çˆ¶çº§èŠ‚ç‚¹å’Œå­çº§èŠ‚ç‚¹ä¸èƒ½è¢«åˆ é™¤,å¶å­èŠ‚ç‚¹æ˜¯å¯ä»¥è¢«åˆ é™¤!!!
            if(this.model.isParent == 1){
                //æç¤ºä¿¡æ¯
                this.$message.warning('å½“å‰èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹ï¼Œä¸èƒ½åˆ é™¤');
                return ;
            }
    
    
            this.$message.confirm('æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­?', 'æç¤º', {
              confirmButtonText: 'ç¡®å®šåˆ é™¤',
              cancelButtonText: 'å–æ¶ˆ',
              type: 'warning'
            }).then(() => {
              this.handleDelete(this.model.id);
            }).catch(()=>{
              this.$message.info('å·²å–æ¶ˆåˆ é™¤');
            })
    
          },
          editChild() {
            this.beginEdit = true;
            this.$nextTick(() => this.$refs[this.model.id].focus());
          },
          //ä¿®æ”¹
          afterEdit() {
            if (this.beginEdit) {
              this.beginEdit = false;
              this.handleEdit(this.model.id, this.model.name);
            }
          },
          handleAdd(node) {
            this.$emit("handleAdd", node);
          },
          handleDelete(id) {
            this.$emit("handleDelete", id);
          },
          handleEdit(id, name) {
            this.$emit("handleEdit", id, name)
          },
          handleClick(node) {
            this.$emit("handleClick", node);
          }
        }
      }
    </script>
    
    <style scoped>
      .level1 {
        height: 40px;
      }
    
      .selected {
        background-color: rgba(105,184,249,0.75);
      }
    </style>
    ```

- ##### ä¾æ¬¡å¯åŠ¨ `eureka-server` , `xxx-service` , `zuul-server` , `vue` é¡¹ç›®

- ä¿è¯è‡ªå·±çš„ hosts, nginxæ²¡æœ‰é—®é¢˜

- æµè§ˆå™¨è¾“å…¥

  ```
  http://manage.mrshop.com/
  ```

  ![](E:\æ·˜å®é¡¹ç›®\image\screenshot_20210106_155026.png)

### ğŸ’¨åˆ†ç±»åˆ é™¤

> åˆ é™¤æ¡ä»¶
>
> 1. çˆ¶èŠ‚ç‚¹ä¸èƒ½è¢«åˆ é™¤
> 2. å¦‚æœæ‰§è¡Œåˆ é™¤æ—¶å‘ç°å·²ç»æ²¡æœ‰å…¶ä»–å¶å­èŠ‚ç‚¹äº† é‚£éœ€è¦å°†åŸæ¥çš„çˆ¶çº§èŠ‚ç‚¹å˜æˆå¶å­èŠ‚ç‚¹

------

##### vueé¡¹ç›®

- Treeltem.vue : line 164

  ```
        deleteChild: function () {
          if(this.model.isParent == 1){
              //æç¤ºä¿¡æ¯
              this.$message.warning('å½“å‰èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹ï¼Œä¸èƒ½åˆ é™¤');
              return ;
          }
          this.$message.confirm('æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­?', 'æç¤º', {
            confirmButtonText: 'ç¡®å®šåˆ é™¤',
            cancelButtonText: 'å–æ¶ˆ',
            type: 'warning'
          }).then(() => {
            this.handleDelete(this.model.id);
          }).catch(()=>{
            this.$message.info('å·²å–æ¶ˆåˆ é™¤');
          })
        },
  ```

- Category.vue

  ```
     handleDelete(id) {
          this.$http.delete('/category/delete?id=' + id).then(resp => {
            if(resp.data.code != 200){
              this.$message.error('åˆ é™¤å¤±è´¥:' + resp.data.message);
              return ;
            }
            this.delKey = new Date().getTime();
            this.$message.success('åˆ é™¤æˆåŠŸ');
          }).catch(error => console.log(error))
        },
  ```

  - ğŸˆ²æ³¨æ„: éœ€è¦ç»™v-treeç»„ä»¶ç»‘å®šä¸€ä¸ªkeyçš„å±æ€§,é»˜è®¤å€¼ä¸º 0

    ```
     data() {
          return {
            delKey:0,
          }
     },
    ```

  - v-treeç»„ä»¶ä¸­åŠ å…¥ :key="delKey"

  - åˆ é™¤æ–¹æ³•ä¸­ åŠ å…¥ this.delKey = new Date().getTime();

  - è¿™æ ·åœ¨åˆ é™¤å®Œæˆåå¯ä»¥å®ç°ç»„ä»¶åˆ·æ–°çš„æ•ˆæœ

------

##### åå°ä»£ç 

- ##### mingrui-shop-service-api-xxx

  - CategoryService

    ```java
     @ApiOperation(value = "åˆ†ç±»åˆ é™¤")
     @DeleteMapping(value = "/category/delete")
     Result<JsonObject> deleteCategoryById(Integer id);
    ```

- ##### mingrui-shop-common-core

  - åœ¨ com.baidu.shop.util ä¸­

    - æ–°å»ºç±» `ObjectUtil` (è®©ä»£ç æ›´ä¼˜é›…)

      ```java
      package com.baidu.shop.utils;
      
      public class ObjectUtil {
          public static Boolean  isNull(Object obj){ return obj == null; }
      }
      ```

  - åœ¨ com.baidu.shop.status ä¸­

    - HTTPStatus

      ```java
      public static final int PARAMS_VALIDATE_ERROR = 5002;//å‚æ•°æ ¡éªŒå¤±è´¥
      ```

- ##### å®ç°ç±»ä¸­è¦åšçš„äº‹

  > 1. é€šè¿‡å½“å‰idæŸ¥è¯¢åˆ†ç±»ä¿¡æ¯
  > 2. åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®
  > 3. åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æ—¶çˆ¶èŠ‚ç‚¹
  > 4. åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸‹ é™¤äº†å½“å‰èŠ‚ç‚¹æ˜¯å¦è¿˜æœ‰åˆ«çš„èŠ‚ç‚¹(ä¸šåŠ¡)
  >    - æ²¡æœ‰: å°†å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ isParent çš„å€¼æ”¹ä¸º0
  > 5. é€šè¿‡ id åˆ é™¤æ•°æ®

- ##### ä»£ç å®ç°

  ```java
  @Override
      @Transactional
      public Result<JsonObject> deleteCategoryById(Integer id) {
          //åˆ¤æ–­idæ˜¯å¦ä¸ºç©º æˆ– å°äº0
          if(ObjectUtil.isNull(id) || id <= 0) return this.setResultError("idä¸åˆæ³•");
          CategoryEntity categoryEntity = categoryMapper.selectByPrimaryKey(id);
          //åˆ¤æ–­æŸ¥è¯¢çš„æ•°æ®æ˜¯å¦ä¸ºç©º
          if(ObjectUtil.isNull(categoryEntity)) return this.setResultError("æ•°æ®ä¸å­˜åœ¨");
          //åˆ¤æ–­æŸ¥è¯¢æ•°æ®çš„çˆ¶èŠ‚ç‚¹ä¸‹æœ‰æ— å…¶ä»–èŠ‚ç‚¹
          if(categoryEntity.getIsParent() >= 1) return this.setResultError("å½“å‰èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹");
          //è·å–çˆ¶èŠ‚ç‚¹ä¸‹çš„å…¶ä»–å­èŠ‚ç‚¹çš„æ•°æ®
          //å¦‚æœå½“å‰åˆ†ç±»è¢«å“ç‰Œç»‘å®šçš„è¯ä¸èƒ½è¢«åˆ é™¤ --> é€šè¿‡åˆ†ç±»idæŸ¥è¯¢ä¸­é—´è¡¨æ˜¯å¦æœ‰æ•°æ® true : å½“å‰åˆ†ç±»ä¸èƒ½è¢«åˆ é™¤ false:ç»§ç»­æ‰§è¡Œ
          Example example1 = new Example(CategoryBrandEntity.class);
          example1.createCriteria().andEqualTo("brandId",id);
          List<CategoryBrandEntity> categoryBrandEntities = categoryBrandMapper.selectByExample(example1);
          if(categoryBrandEntities.size()>=1)return this.setResultError("å½“å‰åˆ†ç±»è¢«å…¶ä»–å“ç‰Œç»‘å®š,æ— æ³•è¿›è¡Œåˆ é™¤");
  
          Example example = new Example(categoryEntity.getClass());
          example.createCriteria().andEqualTo("parentId",categoryEntity.getParentId());
          List<CategoryEntity> categoryList = categoryMapper.selectByExample(example);
          //åˆ¤æ–­å…¶ä»–å­èŠ‚ç‚¹çš„æ•°æ®æ¡æ•°æ˜¯å¦å°äºç­‰äº1SAFJSA
          if(categoryList.size() <= 1){
              CategoryEntity categoryEntity1 = new CategoryEntity();
              //å½“çˆ¶èŠ‚ç‚¹ä¸‹åªæœ‰ä¸€ä¸ªæˆ–æ²¡æœ‰å­èŠ‚ç‚¹æ—¶ASDAS
              //å°†è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„å€¼ä¿®æ”¹ä¸º0
              categoryEntity1.setIsParent(0);
              //å°†è¯¥èŠ‚ç‚¹çš„idä¿®æ”¹ä¸ºè¯¥èŠ‚ç‚¹çš„çˆ¶id
              categoryEntity1.setId(categoryEntity.getParentId());
              categoryMapper.updateByPrimaryKeySelective(categoryEntity1);
          }
          //æ‰§è¡Œåˆ é™¤æ“ä½œ
          categoryMapper.deleteByPrimaryKey(id);
          //è¿”å›ä¸€ä¸ªåˆ é™¤æˆåŠŸçš„ä¿¡æ¯
          return this.setResultSuccess();
      }
  ```

### ğŸ’¨åˆ†ç±»ä¿®æ”¹

##### vueé¡¹ç›®

- å°† Treeltem.vue çš„ afterEdit æ–¹æ³• this.model.beginEdit æ”¹ä¸º this.beginEdit

  ```vue
   afterEdit() {
          if (this.beginEdit) {
            this.beginEdit = false;
            this.handleEdit(this.model.id, this.model.name);
          }
   },
  ```

- Category.vue

  ```vue
  handleEdit(id, name) {
         this.$http.put('/category/update',{
           id:id,
           name:name
         }).then(resp => {
           if(resp.data.code != 200){
              this.$message.error('ä¿®æ”¹å¤±è´¥:' + resp.data.message);
              return ;
            }
            this.delKey = new Date().getTime();
            this.$message.success('ä¿®æ”¹æˆåŠŸ');
         }).catch(error => console.log(error))
  },
  ```

##### åå°ä»£ç 

- mingrui-shop-service-api-xxx

  - CategoryService

    ```java
    @ApiOperation(value = "åˆ†ç±»ä¿®æ”¹")
    @PutMapping(value = "/category/edit")
    Result<JsonObject> putCategoryById(@RequestBody CategoryEntity categoryEntity);
    ```

- mingrui-shop-service-xxx

  - CategoryServiceImpl

    ```java
    @Override
    @Transactional
    public Result<JsonObject> putCategoryById(CategoryEntity categoryEntity) {
         categoryMapper.updateByPrimaryKeySelective(categoryEntity);
         return this.setResultSuccess();
    }
    ```

### ğŸ’¨åˆ†ç±»æ–°å¢

##### vueé¡¹ç›®

- Category.vue

  ```vue
  handleAdd(node) {
          node.isParent = node.isParent?1:0;
          delete node.id;
          this.$http.post('/category/add',node).then(resp =>{     
            if(resp.data.code != 200){
              this.$message.error('æ–°å¢å¤±è´¥');
              return ;
            }
            this.$message.success('æ–°å¢æˆåŠŸ');
            this.delKey = new Date().getTime();
          }).catch(error => console.log(error))
  },
  ```

##### åå°ä»£ç 

- mingrui-shop-service-api-xxx

  - CategoryService

    ```java
    @ApiOperation(value = "åˆ†ç±»æ–°å¢")
    @PostMapping(value = "/category/save")
    Result<JsonObject> addCategoryEntity(@RequestBody CategoryEntity categoryEntity);
    ```

- mingrui-shop-service-xxx

  - CategoryServiceImpl

    ```java
    @Override
        @Transactional
        public Result<JsonObject> addCategoryEntity(CategoryEntity categoryEntity) {
        
            categoryMapper.insertSelective(categoryEntity);
            return this.setResultSuccess();
            
        }
    ```

### ğŸ’¨é¡¹ç›®ä¸­ä¸å®Œç¾çš„åœ°æ–¹

#### å‚æ•°æ ¡éªŒ

- mingrui-shop-common-core å·¥ç¨‹æ–°å»ºåŒ… com.baidu.shop.validate.group

  - åŒ…ä¸‹æ–°å»ºæ“ä½œç±» MingruiOperation

    ```
    package com.baidu.shop.validate.group;
    
    public class MingruiOperation {
    
        public interface Add{}
        public interface Update{}
    
    }
    ```

- mingrui-shop-service-api-xxx

  - CategoryEntity

    ```
    package com.baidu.shop.entity;
    
    import com.baidu.shop.validate.group.MingruiOperation;
    import io.swagger.annotations.ApiModel;
    import io.swagger.annotations.ApiModelProperty;
    import lombok.Data;
    
    import javax.persistence.Id;
    import javax.persistence.Table;
    import javax.validation.constraints.NotEmpty;
    import javax.validation.constraints.NotNull;
    
    @ApiModel(value = "åˆ†ç±»å®ä½“ç±»")//swaggerçš„æ³¨è§£ : å£°æ˜æ¨¡å‹
    @Data
    @Table(name = "tb_category") //java çš„å®ä½“ç±»å’Œæ•°æ®åº“ä¸­çš„è¡¨åšæ˜ å°„
    public class CategoryEntity {
    
        @Id //å£°æ˜ä¸»é”®
        @ApiModelProperty(value = "ç±»ç›®id",example = "1") //æ‰€æœ‰çš„æ•°å­—ç±»å‹åœ¨å†™swaggerçš„æ—¶å€™éœ€è¦åŠ example="é»˜è®¤å€¼",æµ‹è¯•æ¥å£
        @NotNull(message = "idä¸èƒ½ä¸ºç©º", groups = {MingruiOperation.Update.class})
        private Integer id;//å¦‚æœæ²¡æœ‰@Column é»˜è®¤ä½¿ç”¨entityçš„å±æ€§åå’Œ æ•°æ®åº“è¡¨çš„å­—æ®µååšæ˜ å°„
    
        @ApiModelProperty(value = "ç±»ç›®åç§°")
        @NotEmpty(message = "åˆ†ç±»åç§°ä¸èƒ½ä¸ºç©º", groups = {MingruiOperation.Add.class,MingruiOperation.Update.class})
        private String name;
    
        @ApiModelProperty(value = "çˆ¶ç±»ç›®id,é¡¶çº§ç±»ç›®å¡«0",example = "1")
        @NotNull(message = "çˆ¶çº§åˆ†ç±»ä¸èƒ½ä¸ºnull",groups = {MingruiOperation.Add.class})
        private Integer parentId;//ä¼šè‡ªåŠ¨å°†é©¼å³°è½¬æ¢ä¸º _xçš„å½¢å¼
    
        @ApiModelProperty(value = "æ˜¯å¦æ˜¯çˆ¶çº§èŠ‚ç‚¹",example = "1")
        @NotNull(message = "æ˜¯å¦ä¸ºçˆ¶çº§èŠ‚ç‚¹ä¸èƒ½ä¸ºnull",groups = {MingruiOperation.Add.class})
        private Integer isParent;
    
        @ApiModelProperty(value = "æ’åº",example = "1")
        @NotNull(message = "æ’åºå­—æ®µä¸èƒ½ä¸ºnull",groups = {MingruiOperation.Add.class})
        private Integer sort;
    
    }
    ```

  - CategoryService

    ```java
    package com.baidu.shop.service;
    
    import com.baidu.shop.base.Result;
    import com.baidu.shop.entity.CategoryEntity;
    import com.baidu.shop.validate.group.MingruiOperation;
    import com.google.gson.JsonObject;
    import io.swagger.annotations.Api;
    import io.swagger.annotations.ApiOperation;
    import org.springframework.validation.annotation.Validated;
    import org.springframework.web.bind.annotation.*;
    
    import java.util.List;
    
    @Api(tags = "å•†å“åˆ†ç±»æ¥å£") // å£°æ˜æ¥å£
    public interface CategoryService {
    
        @ApiOperation(value = "é€šè¿‡pidæŸ¥è¯¢å•†å“åˆ†ç±»")
        @GetMapping(value = "category/list")
        Result<List<CategoryEntity>> getCategoryByPid(Integer pid);
    
        @ApiOperation(value = "é€šè¿‡idè¿›è¡Œåˆ†ç±»åˆ é™¤")
        @DeleteMapping(value = "/category/delete")
        Result<JsonObject> deleteCategoryById(Integer id);
    
    
        @ApiOperation(value = "åˆ†ç±»ä¿®æ”¹")
        @PutMapping(value = "/category/edit")
        Result<JsonObject> putCategoryById(@Validated({MingruiOperation.Update.class}) @RequestBody CategoryEntity categoryEntity);
    
        @ApiOperation(value = "åˆ†ç±»æ–°å¢")
        @PostMapping(value = "/category/save")
        Result<JsonObject> addCategoryEntity(@Validated({MingruiOperation.Add.class}) @RequestBody CategoryEntity categoryEntity);
    
    }
    ```

#### å…¨å±€å¼‚å¸¸å¤„ç†

- mingrui-shop-common-core 

  - pom.xml

    ```java
    <!-- SpringBoot-æ•´åˆWebç»„ä»¶ -->
    <dependency>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    ```

  - com.baidu.shop.status

    - HTTPStatus

      ```
      public static final int PARAMS_VALIDATE_ERROR = 5002;//å‚æ•°æ ¡éªŒå¤±è´¥
      ```

- æ–°å»ºåŒ… com.baidu.shop.global

  - æ–°å»ºå…¨å±€å¼‚å¸¸å¤„ç†ç±» GlobalException

    ```
    package com.baidu.shop.global;
    
    import com.alibaba.fastjson.JSONObject;
    import com.baidu.shop.base.Result;
    import com.baidu.shop.status.HTTPStatus;
    import com.google.gson.JsonObject;
    import lombok.extern.slf4j.Slf4j;
    import org.springframework.validation.FieldError;
    import org.springframework.web.bind.MethodArgumentNotValidException;
    import org.springframework.web.bind.annotation.ExceptionHandler;
    import org.springframework.web.bind.annotation.RestControllerAdvice;
    
    import java.util.*;
    import java.util.stream.Collector;
    import java.util.stream.Collectors;
    
    
    @RestControllerAdvice
    @Slf4j
    public class GlobalException {
    
        @ExceptionHandler(value = RuntimeException.class)
        public Result<JSONObject> testException(RuntimeException e){
            log.error("code : {} , message : {}",HTTPStatus.ERROR,e.getMessage());
            return new Result<JSONObject>(HTTPStatus.ERROR,e.getMessage(),null);
        }
        @ExceptionHandler(value= MethodArgumentNotValidException.class)
        public Map<String,Object> methodArgumentNotValidHandler(MethodArgumentNotValidException exception) throws Exception{
            HashMap<String, Object> map = new HashMap<>();
            map.put("code",HTTPStatus.PARAMS_VALIDATE_ERROR);
            List<String> msgList = new ArrayList<>();
            exception.getBindingResult().getFieldErrors().stream().forEach(error -> {
                msgList.add("Field --> " + error.getField() + " : " + error.getDefaultMessage());
                log.error("Field --> " + error.getField() + " : " + error.getDefaultMessage());
            });
            String message = msgList.parallelStream().collect(Collectors.joining(","));
            map.put("massage",message);
            return map;
        }
    
    }
    ```

#### Swagger

- mingrui-shop-service-api

  - pom.xml

    ```
    <dependencies>
            <!--å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿç”ŸæˆAPIæ–‡æ¡£-->
            <dependency>
                <groupId>io.springfox</groupId>
                <artifactId>springfox-swagger2</artifactId>
                <version>2.9.2</version>
            </dependency>
            <!--æä¾›å¯è§†åŒ–çš„APIæ–‡æ¡£-->
            <dependency>
                <groupId>io.springfox</groupId>
                <artifactId>springfox-swagger-ui</artifactId>
                <version>2.9.2</version>
            </dependency>
    </dependencies>
    ```

- mingrui-shop-service-api-xxx

  - åœ¨ com.baidu.shop ä¸‹æ–°å»º config åŒ…

  - åœ¨ config åŒ…ä¸‹æ–°å»ºMrSwagger2Config

    ```
    package com.baidu.shop.config;
    
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    import springfox.documentation.builders.ApiInfoBuilder;
    import springfox.documentation.builders.PathSelectors;
    import springfox.documentation.builders.RequestHandlerSelectors;
    import springfox.documentation.service.ApiInfo;
    import springfox.documentation.service.Contact;
    import springfox.documentation.spi.DocumentationType;
    import springfox.documentation.spring.web.plugins.Docket;
    import springfox.documentation.swagger2.annotations.EnableSwagger2;
    
    @Configuration
    @EnableSwagger2
    public class MrSwagger2Config {
    
        @Bean
        public Docket createRestApi(){
            return new Docket(DocumentationType.SWAGGER_2)
                    .apiInfo(this.apiInfo())
                    .select()
                    .apis(RequestHandlerSelectors.basePackage("com.baidu"))
                    .paths(PathSelectors.any())
                    .build();
        }
    
        private ApiInfo apiInfo(){
            return new ApiInfoBuilder()
                    //æ ‡é¢˜
                    .title("æ˜ç‘SWAGGER2æ ‡é¢˜")
                    //æ¡æ¬¾åœ°å€
                    .termsOfServiceUrl("http://www.baidu.com")
                    //è”ç³»æ–¹å¼-->æœ‰Stringå‚æ•°çš„æ–¹æ³•ä½†æ˜¯å·²ç»è¿‡æ—¶ï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨
                    .contact(new Contact("shenyaqi","baidu.com","shenyaqiii@163.com"))
                    //ç‰ˆæœ¬
                    .version("v1.0")
                    //é¡¹ç›®æè¿°
                    .description("æè¿°")
                    //åˆ›å»ºAPIåŸºæœ¬ä¿¡æ¯
                    .build();
        }
    
    }
    ```

    

