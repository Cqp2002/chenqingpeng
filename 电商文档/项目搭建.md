# Spring Cloud é¡¹ç›®æ­å»º

#### â‘  é¡¹ç›®ç»“æ„ 

- ##### mingrui-shop-parent

  - â€‹	mingrui-shop-basics
    - mingrui-shop-basic-upload-server(ä¸Šä¼ æ–‡ä»¶ä½¿ç”¨)
    - mingrui-shop-basic-zuul-server( 8088 ç½‘å…³)
    - mingrui-shop-basic-eureka-server (æœåŠ¡ç«¯)
  - â€‹	mingrui-shop-commoms
    - mingrui-shop-common-core

  - â€‹	mingrui-shop-service
    - mingrui-shop-service-xxx

  - â€‹	mingrui-shop-service-api
    - mingrui-shop-service-api-xxx

------

#### â‘¡ é¡¹ç›®æ­å»º

##### 1. åˆ›å»ºçˆ¶å·¥ç¨‹

- é¡¹ç›®åä¸º: `mingrui-shop-parent` ( mavené¡¹ç›® )
- åˆ é™¤srcæ–‡ä»¶å¤¹
- pom.xml

```
<packaging>pom</packaging>

    <properties>
        <!--é¡¹ç›®æ„å»ºç¼–ç -->
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF8</project.reporting.outputEncoding>
        <!--å£°æ˜JDKç‰ˆæœ¬-->
        <java.version>1.8</java.version>
        <!--spring cloud ç‰ˆæœ¬.æ³¨æ„æ­¤ç‰ˆæœ¬æ˜¯å»ºç«‹åœ¨boot2.2.2ç‰ˆæœ¬ä¸Šçš„-->
        <mr.spring.cloud.version>Hoxton.SR1</mr.spring.cloud.version>
    </properties>
    <!--boot ç‰ˆæœ¬-->
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.3.1.RELEASE</version>
        <!--å§‹ç»ˆä»ä»“åº“ä¸­è·å–ï¼Œä¸ä»æœ¬åœ°è·¯å¾„è·å–-->
        <relativePath />
    </parent>
    <dependencies>
        <!-- é›†æˆcommonså·¥å…·ç±» -->
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
        </dependency>
        <!-- é›†æˆlombok æ¡†æ¶ -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
        <!--junitæµ‹è¯•-->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
        </dependency>
        <!-- SpringBootæ•´åˆeurekaå®¢æˆ·ç«¯ -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>
        <!--boot æµ‹è¯•æ¨¡å—-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <!--å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿç”ŸæˆAPIæ–‡æ¡£-->
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-swagger2</artifactId>
            <version>2.9.2</version>
        </dependency>
        <!--æä¾›å¯è§†åŒ–çš„APIæ–‡æ¡£-->
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-swagger-ui</artifactId>
            <version>2.9.2</version>
        </dependency>
    </dependencies>
    <!-- é¡¹ç›®ä¾èµ–,å­çº§æ¨¡å—å¯ä»¥ç»§æ‰¿ä¾èµ–-->
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${mr.spring.cloud.version}</version>
                <type>pom</type>
                <!--è§£å†³mavenå•ç»§æ‰¿çš„é—®é¢˜-->
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>
    <!-- æ³¨æ„ï¼š è¿™é‡Œå¿…é¡»è¦æ·»åŠ ï¼Œ å¦è€…å„ç§ä¾èµ–æœ‰é—®é¢˜ -->
    <repositories>
        <repository>
            <id>spring-milestones</id>
            <name>Spring Milestones</name>
            <url>https://repo.spring.io/libs-milestone</url>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
    </repositories>
```

##### 2. åˆ›å»ºåŸºç¡€æœåŠ¡çˆ¶å·¥ç¨‹

- åœ¨ `mingrui-shop-parent` å·¥ç¨‹åä¸Šå³é”®-->new-->module

- é¡¹ç›®åä¸º: `mingrui-shop-basics`
  - åˆ é™¤ src æ–‡ä»¶å¤¹
    -   `*çˆ¶å·¥ç¨‹ä¸éœ€è¦å†™ä»»ä½•ä»£ç *`

- pom.xml
  - `***åªéœ€è¦æŠŠæ‰“åŒ…æ–¹å¼è®¾ç½®ä¸ºpomå³å¯,æš‚æ—¶å…ˆä¸è¦å¼•å…¥å…¶ä»–ä¾èµ–***`

```
<!--çˆ¶çº§é¡¹ç›®ä¸éœ€è¦æ‰“åŒ…æ‰€æœ‰packgingçš„ç±»å‹ä¸ºpom-->
    <packaging>pom</packaging>
```

##### 3. åˆ›å»ºå…¬å…±(å·¥å…·)å·¥ç¨‹

- åœ¨ `mingrui-shop-parent` å·¥ç¨‹åä¸Šå³é”®-->new-->module

- é¡¹ç›®åä¸º: `mingrui-shop-commoms`

  - åˆ é™¤ src æ–‡ä»¶å¤¹
    - **`çˆ¶å·¥ç¨‹ä¸éœ€è¦å†™ä»»ä½•ä»£ç `**

- pom.xml

  ```
   <!--çˆ¶çº§é¡¹ç›®ä¸éœ€è¦æ‰“åŒ…æ‰€æœ‰packgingçš„ç±»å‹ä¸ºpom-->
      <packaging>pom</packaging>
  ```

##### 4. åˆ›å»ºæœåŠ¡å®ç°å·¥ç¨‹

- åœ¨ `mingrui-shop-parent` å·¥ç¨‹åä¸Šå³é”® --> new --> module

- é¡¹ç›®åä¸º: `mingrui-shop-service`

  - åˆ é™¤ src æ–‡ä»¶å¤¹
    - `*çˆ¶å·¥ç¨‹ä¸éœ€è¦å†™ä»»ä½•ä»£ç *`

- pom.xml

  ```
  <!--çˆ¶çº§é¡¹ç›®ä¸éœ€è¦æ‰“åŒ…æ‰€æœ‰packgingçš„ç±»å‹ä¸ºpom-->
      <packaging>pom</packaging>
      <modules>
          <module>mingrui-shop-service-xxx</module>
      </modules>
      <dependencies>
          <!-- SpringBoot-æ•´åˆWebç»„ä»¶ -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-web</artifactId>
          </dependency>
          <!-- springcloud feignç»„ä»¶ -->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-openfeign</artifactId>
          </dependency>
          <!--mysqlæ•°æ®åº“è¿æ¥-->
          <dependency>
              <groupId>mysql</groupId>
              <artifactId>mysql-connector-java</artifactId>
              <scope>runtime</scope><!--é¡¹ç›®è¿è¡Œé˜¶æ®µä½¿ç”¨-->
          </dependency>
          <!--é€šç”¨mapper-->
          <dependency>
              <groupId>tk.mybatis</groupId>
              <artifactId>mapper-spring-boot-starter</artifactId>
              <version>2.1.5</version>
          </dependency>
  
          <!--åˆ†é¡µå·¥å…·
          è‡ªå®šä¹‰çš„ mybatis æ’ä»¶
          mybatisè¿è¡ŒåŸç† mybatisçš„æ‰§è¡Œå™¨-->
          <dependency>
              <groupId>com.github.pagehelper</groupId>
              <artifactId>pagehelper-spring-boot-starter</artifactId>
              <version>1.2.10</version>
          </dependency>
  
          <dependency>
              <groupId>com.baidu</groupId>
              <artifactId>mingrui-shop-service-api-xxx</artifactId>
              <version>1.0-SNAPSHOT</version>
          </dependency>
      </dependencies>
  ```

##### 5. åˆ›å»ºæœåŠ¡æ¥å£å·¥ç¨‹

- åœ¨ `mingrui-shop-parent` å·¥ç¨‹åä¸Šå³é”® --> new --> module

- é¡¹ç›®åä¸º: `mingrui-shop-service-api`

  - åˆ é™¤ src æ–‡ä»¶å¤¹
    - `*çˆ¶å·¥ç¨‹ä¸éœ€è¦å†™ä»»ä½•ä»£ç *` 

- pom.xml

  ```
  <!--çˆ¶çº§é¡¹ç›®ä¸éœ€è¦æ‰“åŒ…æ‰€æœ‰packgingçš„ç±»å‹ä¸ºpom-->
      <packaging>pom</packaging>
  
      <dependencies>
          
          <!-- SpringBoot-æ•´åˆWebç»„ä»¶ -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-web</artifactId>
          </dependency>
  
      </dependencies>
  ```

##### 6. åˆ›å»º eureka æœåŠ¡

- åœ¨ `mingrui-shop-basics` å·¥ç¨‹åä¸Šå³é”®--> new --> module	

- é¡¹ç›®åä¸º: `mingrui-shop-basics-eureka-server`

  - ###### æ³¨æ„ğŸˆ²: åœ¨ç‚¹å‡»finishä¹‹å‰ä¸€å®šè¦ç¡®è®¤ä¸€éå½“å‰åˆ›å»ºå·¥ç¨‹çš„çˆ¶å·¥ç¨‹æ˜¯mingrui-shop-basics,æ¥ä¸‹æ¥çš„é¡¹ç›®åˆ›å»ºçš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·çš„.

- pom.xml

  ```
  <dependencies>
          <!--eureka æœåŠ¡ä¾èµ–-->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
          </dependency>
      </dependencies>
  ```

- application.yml

  ```
  server:
      port: 8761
  spring:
      application:
          name: eureka-server
  eureka:
      client:
  # eurekaæœåŠ¡url,å€¼ä¸ºmapé›†åˆé»˜è®¤keyä¸ºdefaultZone
          service-url:
              defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka
  # å½“å‰æœåŠ¡æ˜¯å¦åŒæ—¶æ³¨å†Œ
          register-with-eureka: false
  # å»æ³¨å†Œä¸­å¿ƒè·å–å…¶ä»–æœåŠ¡çš„åœ°å€
          fetch-registry: false
      instance:
          hostname: localhost
  # å®šä¹‰æœåŠ¡ç»­çº¦ä»»åŠ¡ï¼ˆå¿ƒè·³ï¼‰çš„è°ƒç”¨é—´éš”ï¼Œå•ä½ï¼šç§’ é»˜è®¤30
          lease-renewal-interval-in-seconds: 1
  # å®šä¹‰æœåŠ¡å¤±æ•ˆçš„æ—¶é—´ï¼Œå•ä½ï¼šç§’ é»˜è®¤90
          lease-expiration-duration-in-seconds: 2
      server:
  # æµ‹è¯•æ—¶å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡åŠæ—¶è¸¢å‡º
          enable-self-preservation: false
  
  ```

- å¯åŠ¨ç±»

  ```
  package com.baidu.shop;
  
  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;
  
  @SpringBootApplication
  @EnableEurekaServer
  public class RunEurekaServerApplication {
  
      public static void main(String[] args) {
          SpringApplication.run(RunEurekaServerApplication.class);
      }
  
  }
  
  ```